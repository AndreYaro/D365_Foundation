<?xml version="1.0" encoding="utf-8"?>
<AxForm xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="Microsoft.Dynamics.AX.Metadata.V6">
	<Name>ProjSalesPriceRevenue</Name>
	<SourceCode>
		<Methods xmlns="">
			<Method>
				<Name>classDeclaration</Name>
				<Source><![CDATA[
[Form]
    public class ProjSalesPriceRevenue extends FormRun
    {
        QueryBuildRange     criteriaProjId;
        QueryBuildRange     criteriaResource;
        QueryBuildRange     criteriaProjPriceGroup;
        QueryBuildRange     criteriaProjValidFor;

        boolean             fromMainSetup;
        CurrencyCode        currencyCode;
        ProjId              relationProjId;
        ProjPriceGroupID    relationPriceGroup;
        ProjId              projId;
        CustAccount         relationCustAccount;
        str                 relationDisplayText;

        #define.star("*")
        #DEFINE.displayOptionBlank("")
        #DEFINE.displayOptionTable("@SYS8868")
        #DEFINE.displayOptionGroup("@SYS3815")
        #DEFINE.displayOptionAll("@SYS11696")

        PriceDiscGroup          priceDiscGroup;
        ProjTable               projTable;
        ProjInvoiceTable        projInvoiceTable;
        CustTable               custTable;
        ProjJournalTrans        projJournalTrans;
        ProjForecastRevenue     projForecastRevenue;
        SMAAgreementTable       agreementTable;
        SMAServiceOrderTable    smaServiceOrderTable;
        ProjCategory            projCategory;
        HcmWorker               hcmWorker;
        ResourceView            resourceView;
        SalesQuotationTable     salesQuotationTable;

}
]]></Source>
			</Method>
			<Method>
				<Name>init</Name>
				<Source><![CDATA[
    public void init()
    {
        super();

        currencyCode        = Ledger::accountingCurrency(CompanyInfo::findDataArea(curext()).RecId);
        relationCustAccount = '';
        relationProjId      = '';
        relationDisplayText = '';

        if (isConfigurationkeyEnabled(configurationKeyNum(PriceDisc)))
        {
            // Record is required from the calling dataset
            if ((!element.args().record()) && (element.args().dataset()))
            {
                throw error("@SYS34359");
            }

            // Set defaults depending on the dataset
            switch (element.args().dataset())
            {
                case tableNum(PriceDiscGroup):
                    topGroup.visible(false);
                    displayOption.selection(TableGroupAll::GroupId);
                    break;

                case tableNum(ProjTable):
                    projTable           = element.args().record();
                    currencyCode        = projTable.currencyId();
                    relationProjId      = projTable.ProjId;
                    relationPriceGroup  = projTable.ProjPriceGroup;
                    relationDisplayText = relationProjId;
                    break;

                case tableNum(ProjInvoiceTable):
                    projInvoiceTable    = element.args().record();
                    currencyCode        = projInvoiceTable.CurrencyId;
                    relationPriceGroup  = projInvoiceTable.ProjPriceGroup;
                    relationProjId      = projInvoiceTable.ProjInvoiceProjId;
                    relationDisplayText = relationProjId;
                    break;

                case tableNum(CustTable):
                    custTable           = element.args().record();
                    currencyCode        = custTable.Currency;
                    relationPriceGroup  = custTable.PriceGroup;
                    relationCustAccount = custTable.AccountNum;
                    relationDisplayText = relationCustAccount;
                    break;

                case tableNum(ProjJournalTrans):
                    projJournalTrans    = element.args().record();
                    projTable           = ProjTable::find(projJournalTrans.ProjId);
                    currencyCode        = projTable.currencyId();
                    relationProjId      = projJournalTrans.ProjId;
                    relationPriceGroup  = projTable.ProjPriceGroup;
                    relationDisplayText = relationProjId;
                    break;

                case tableNum(ProjForecastRevenue):
                    projForecastRevenue = element.args().record();
                    projTable           = ProjTable::find(projForecastRevenue.ProjId);
                    currencyCode        = projTable.currencyId();
                    relationProjId      = projForecastRevenue.ProjId;
                    relationPriceGroup  = projTable.ProjPriceGroup;
                    relationDisplayText = relationProjId;
                    break;

                case(tableNum(SMAAgreementTable)):
                    agreementTable      = element.args().record();
                    projTable           = ProjTable::find(agreementTable.ProjId);
                    currencyCode        = projTable.currencyId();
                    relationProjId      = projTable.ProjId;
                    relationPriceGroup  = projTable.ProjPriceGroup;
                    relationDisplayText = relationProjId;
                    break;

                case(tableNum(SMAServiceOrderTable)):
                    smaServiceOrderTable = element.args().record();
                    projTable            = ProjTable::find(smaServiceOrderTable.ProjId);
                    currencyCode         = projTable.currencyId();
                    relationProjId       = projTable.ProjId;
                    relationPriceGroup   = projTable.ProjPriceGroup;
                    relationDisplayText  = relationProjId;
                    break;

                case(tableNum(ProjCategory)):
                    projCategory        = element.args().record();
                    relationDisplayText = projCategory.CategoryId;
                    break;

                case(tableNum(HcmWorker)):
                    hcmWorker           = element.args().record();
                    relationDisplayText = hcmWorker.PersonnelNumber;
                    break;

                case(tablenum(ResourceView)):
                    resourceView        = element.args().record();
                    relationDisplayText = resourceView.ResourceId;
                    break;

                case(tableNum(SalesQuotationTable)):
                    salesQuotationTable = element.args().record();
                    relationCustAccount = salesQuotationTable.CustAccount;
                    currencyCode        = salesQuotationTable.CurrencyCode;
                    relationPriceGroup  = salesQuotationTable.PriceGroupId;
                    relationDisplayText = salesQuotationTable.CustAccount;
                    break;
            }

            relation.text(relationDisplayText);
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>initPriceGroupFields</Name>
				<Source><![CDATA[
    void initPriceGroupFields()
    {
        boolean     existingRecord;

        // Check if its an existing record
        if (projRevenueSalesPrice.RecId)
        {
            existingRecord = true;
        }

        // Disable and enable fields based on the value of ProjValidFor and where it was called
        switch (projRevenueSalesPrice.ProjValidFor)
        {
            case TableGroupAll::Table :
                projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup)).allowEdit(false);
                projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup)).skip(true);
                if ((element.args().dataset()) &&
                   ((element.args().dataset() != tableNum(ProjInvoiceTable)) &&
                    (element.args().dataset() != tableNum(CustTable)) &&
                    (element.args().dataset() != tableNum(HcmWorker)) &&
                    (element.args().dataset() != tablenum(ResourceView)) &&
                    (element.args().dataset() != tablenum(SalesQuotationTable)) &&
                    (element.args().dataset() != tableNum(ProjCategory))) || existingRecord)
                {
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjId)).allowEdit(false);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjId)).skip(true);
                }
                else
                {
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjId)).allowEdit(true);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjId)).skip(false);

                    if (isConfigurationkeyEnabled(configurationKeyNum(Project)))
                    {
                        projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaProjInvoiceProjId)).allowEdit(true);
                        projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaProjInvoiceProjId)).skip(false);
                        projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaCustAccount)).allowEdit(true);
                        projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaCustAccount)).skip(false);
                    }
                }
                break;

            case TableGroupAll::GroupId:
                projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjId)).allowEdit(false);
                projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjId)).skip(true);

                if (isConfigurationkeyEnabled(configurationKeyNum(Project)))
                {
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaProjInvoiceProjId)).allowEdit(false);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaProjInvoiceProjId)).skip(true);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaCustAccount)).allowEdit(false);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaCustAccount)).skip(true);
                }

                if ((element.args().dataset()) &&
                    ((element.args().dataset() != tableNum(HcmWorker)) &&
                    (element.args().dataset() != tablenum(ResourceView)) &&
                    (element.args().dataset() != tableNum(ProjCategory))) || existingRecord)
                {
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup)).allowEdit(false);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup)).skip(true);
                }
                else
                {
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup)).allowEdit(true);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup)).skip(false);
                }
                break;

            case TableGroupAll::All:
                projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup)).allowEdit(false);
                projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup)).skip(true);
                projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjId)).allowEdit(false);
                projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjId)).skip(true);
                
				if (isConfigurationkeyEnabled(configurationKeyNum(Project)))
                {
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaProjInvoiceProjId)).allowEdit(false);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaProjInvoiceProjId)).skip(true);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaCustAccount)).allowEdit(false);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, psaCustAccount)).skip(true);
                }

                break;
        }

        if ((displayOption.valueStr() == #displayOptionBlank) &&
            (element.args().dataset() != tableNum(PriceDiscGroup)) && !existingRecord)
        {
            projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjValidFor)).allowEdit(true);
            projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjValidFor)).skip(false);
        }
        else
        {
            if (element.args().dataset() &&
                ((element.args().dataset() == tablenum(HcmWorker)) ||
                 (element.args().dataset() == tablenum(ResourceView)) ||
                 (element.args().dataset() == tablenum(ProjCategory))))
            {
                ProjRevenueSalesPrice_DS.object(fieldNum(ProjRevenueSalesPrice, ProjValidFor)).allowEdit(true);
                ProjRevenueSalesPrice_DS.object(fieldNum(ProjRevenueSalesPrice, ProjValidFor)).skip(true);
            }
            else
            {
                projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjValidFor)).allowEdit(false);
                projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjValidFor)).skip(true);
            }
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>initRelation</Name>
				<Source><![CDATA[
    void initRelation()
    {
        projRevenueSalesPrice_ds.allowCreate(true);

        // Set value to relation field this is either ProjId, Price Group of empty.
        switch (displayOption.valueStr())
        {
            case #displayOptionBlank, #displayOptionAll:
                relation.text('');
                break;

            case #displayOptionTable:
                relation.text(relationDisplayText);
                break;

            case #displayOptionGroup:
                relation.text(relationPriceGroup);

                //
                // Don't allow to add records when there is no Price Group assigned to a ProjId except if
                // its called from main setup, HcmWorker, ResourceView or ProjCategory
                //
                if ((!relationPriceGroup) && (!fromMainSetup) &&
                    ((element.args().dataset() != tableNum(HcmWorker)) &&
                     (element.args().dataset() != tablenum(ResourceView)) &&
                     (element.args().dataset() != tableNum(ProjCategory))))
                {
                    projRevenueSalesPrice_ds.allowCreate(false);
                }
                break;
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>reSelect</Name>
				<Source><![CDATA[
    void reSelect()
    {
        // Rerun the query to get a new set of data based on the new Display Option selected
        this.initRelation();
        projRevenueSalesPrice_ds.init();
        projRevenueSalesPrice_ds.executeQuery();
        projRevenueSalesPrice_ds.queryRun().saveUserSetup(false);

        //
        // Don't display any records if ProjId or PriceGroup are empty except it is called from
        // HcmWorker, ResourceView, ProjCategory, CustTable, ProjInvoiceTable, SalesQuotationTable
        //
        if (!fromMainSetup &&
            (element.args().dataset() != tableNum(HcmWorker)) &&
            (element.args().dataset() != tableNum(ResourceView)) &&
            (element.args().dataset() != tableNum(ProjCategory)) &&
            (((displayOption.valueStr() == #displayOptionTable) &&
            (!relationProjId) &&
            (element.args().dataset() != tableNum(CustTable)) &&
            (element.args().dataset() != tableNum(SalesQuotationTable)) &&
            (element.args().dataset() != tableNum(ProjInvoiceTable))) ||
            ((displayOption.valueStr() == #displayOptionGroup) &&
            (!relationPriceGroup))))
        {
            projRevenueSalesPrice.doClear();
        }

        projRevenueSalesPrice_ds.refresh();
    }

]]></Source>
			</Method>
		</Methods>
		<DataSources xmlns="">
			<DataSource>
				<Name>ProjRevenueSalesPrice</Name>
				<Methods>
					<Method>
						<Name>active</Name>
						<Source><![CDATA[
        public int active()
        {
            int ret;

            ret = super();

            if (isConfigurationkeyEnabled(configurationKeyNum(PriceDisc)))
            {
                element.initPriceGroupFields();
            }

            return ret;
        }

]]></Source>
					</Method>
					<Method>
						<Name>initValue</Name>
						<Source><![CDATA[
        public void initValue()
        {
            super();

            projRevenueSalesPrice.CurrencyId = currencyCode;
            if (isConfigurationkeyEnabled(configurationKeyNum(PriceDisc)))
            {
                projRevenueSalesPrice.ProjId = '';
                projRevenueSalesPrice.ProjPriceGroup = '';

                switch (displayOption.valueStr())
                {
                    case #displayOptionBlank :
                        projRevenueSalesPrice.ProjValidFor = TableGroupAll::Table;
                        break;

                    case #displayOptionTable :
                        if (element.args().dataset() == tableNum(ProjInvoiceTable))
                        {
                            projRevenueSalesPrice.psaProjInvoiceProjId = relationProjId;
                        }
                        else if (element.args().dataset() == tableNum(CustTable) ||
                                element.args().dataset() == tableNum(SalesQuotationTable))
                        {
                            projRevenueSalesPrice.psaCustAccount = relationCustAccount;
                        }
                        else
                        {
                            projRevenueSalesPrice.ProjId = relationProjId;
                        }

                        projRevenueSalesPrice.ProjValidFor = TableGroupAll::Table;
                        break;

                    case #displayOptionGroup :
                        projRevenueSalesPrice.ProjPriceGroup = relationPriceGroup;
                        projRevenueSalesPrice.ProjValidFor = TableGroupAll::GroupId;
                        break;

                    case #displayOptionAll :
                        projRevenueSalesPrice.ProjValidFor = TableGroupAll::All;
                        break;
                }
            }
        }

]]></Source>
					</Method>
					<Method>
						<Name>linkActive</Name>
						<Source><![CDATA[
        void linkActive()
        {
            if (!isConfigurationkeyEnabled(configurationKeyNum(PriceDisc)))
            {
                switch (element.args().dataset())
                {
                    case(tableNum(ProjTable)):
                        projTable       = element.args().record();
                        currencyCode    = projTable.currencyId();
                        projId          = projTable.ProjId;
                        criteriaProjId.value(projId + #star);
                        break;

                    case(tableNum(SMAAgreementTable)):
                        agreementTable   = element.args().record();
                        projTable       = ProjTable::find(agreementTable.ProjId);
                        currencyCode    = projTable.currencyId();
                        projId          = projTable.ProjId;
                        criteriaProjId.value(projId);
                        break;
                }
            }

            super();
        }

]]></Source>
					</Method>
					<Method>
						<Name>init</Name>
						<Source><![CDATA[
        void init()
        {
            Query                   query;
            QueryBuildDataSource    qB;

            super();

            if (isConfigurationkeyEnabled(configurationKeyNum(PriceDisc)))
            {
                // Initialize choices in DisplayOption
                if (!(displayOption.getText(1)))
                {
                    if (!(element.args().dataset()))
                    {
                        displayOption.add(#displayOptionBlank);
                        fromMainSetup = true;
                    }

                    displayOption.add(#displayOptionTable);
                    displayOption.add(#displayOptionGroup);
                    displayOption.add(#displayOptionAll);
                }

                projRevenueSalesPrice_ds.autoQuery(false);
                query   = new Query();
                qB      = query.addDataSource(tableNum(ProjRevenueSalesPrice));

                // Caller is form PriceDiscGroup
                if ((element.args().dataset()) == tableNum(PriceDiscGroup))
                {
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjId)).allowEdit(false);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjId)).skip(true);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup)).allowEdit(false);
                    projRevenueSalesPrice_ds.object(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup)).skip(true);

                    priceDiscGroup         = element.args().record();
                    relationPriceGroup     = priceDiscGroup.GroupId;
                    criteriaProjPriceGroup = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup));
                    criteriaProjPriceGroup.value(relationPriceGroup);
                }
                else
                {
                    element.initRelation();

                    // Initialize query depending on selection in DisplayOption
                    switch (displayOption.valueStr())
                    {
                        case #displayOptionBlank :
                            break;

                        case #displayOptionTable :

                            switch (element.args().dataset())
                            {
                                case tableNum(ProjTable):
                                    criteriaProjId = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjId));
                                    projTable       = element.args().record();
                                    projId          = projTable.ProjId;
                                    criteriaProjId.value(projId + #star);
                                    break;

                                case tableNum(ProjInvoiceTable):
                                    criteriaProjId         = qB.addRange(fieldNum(ProjRevenueSalesPrice, psaProjInvoiceProjId));
                                    projInvoiceTable       = element.args().record();
                                    criteriaProjId.value(projInvoiceTable.ProjInvoiceProjId + #star);
                                    break;

                                case tableNum(CustTable):
                                    criteriaProjId         = qB.addRange(fieldNum(ProjRevenueSalesPrice, psaCustAccount));
                                    custTable              = element.args().record();
                                    criteriaProjId.value(custTable.AccountNum + #star);
                                    break;

                                case(tableNum(ProjJournalTrans)):
                                    criteriaProjId   = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjId));
                                    projJournalTrans = element.args().record();
                                    criteriaProjId.value(projJournalTrans.ProjId);
                                    break;

                                case(tableNum(ProjForecastRevenue)):
                                    criteriaProjId      = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjId));
                                    projForecastRevenue = element.args().record();
                                    criteriaProjId.value(projForecastRevenue.ProjId);
                                    break;

                                case(tableNum(SMAAgreementTable)):
                                    criteriaProjId = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjId));
                                    agreementTable = element.args().record();
                                    criteriaProjId.value(agreementTable.ProjId);
                                    break;

                                case(tableNum(SMAServiceOrderTable)):
                                    criteriaProjId = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjId));
                                    smaServiceOrderTable = element.args().record();
                                    criteriaProjId.value(smaServiceOrderTable.ProjId);
                                    break;

                                case(tableNum(ProjCategory)):
                                    criteriaProjId  = qB.addRange(fieldNum(ProjRevenueSalesPrice, CategoryId));
                                    projCategory    = element.args().record();
                                    criteriaProjId.value(projCategory.CategoryId + #star);
                                    break;

                                case(tableNum(HcmWorker)):
                                    hcmWorker       = element.args().record();
                                    criteriaResource = qB.addRange(fieldnum(ProjRevenueSalesPrice, Resource));
                                    criteriaResource.value(queryValue(ResourceFacade::findByWorker(hcmWorker.RecId)));
                                    break;

                                case(tablenum(ResourceView)):
                                    criteriaResource    = qB.addRange(fieldnum(ProjRevenueSalesPrice, Resource));
                                    resourceView        = element.args().record();
                                    criteriaResource.value(queryValue(resourceView.RecId));
                                    break;

                                case tableNum(SalesQuotationTable):
                                    criteriaProjId         = qB.addRange(fieldNum(ProjRevenueSalesPrice, psaCustAccount));
                                    salesQuotationTable    = element.args().record();
                                    criteriaProjId.value(salesQuotationTable.CustAccount + #star);
                                    break;

                                default:
                                    criteriaProjValidFor = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjValidFor));
                                    criteriaProjValidFor.value(int2str(TableGroupAll::Table));
                                    break;
                            }
                            break;

                        case #displayOptionGroup :

                            switch (element.args().dataset())
                            {
                                case tableNum(ProjTable),
                                     tableNum(ProjInvoiceTable),
                                     tableNum(CustTable),
                                     tableNum(ProjJournalTrans),
                                     tableNum(ProjForecastRevenue),
                                     tableNum(SMAAgreementTable),
                                     tableNum(SalesQuotationTable),
                                     tableNum(SMAServiceOrderTable):
                                    criteriaProjPriceGroup = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjPriceGroup));
                                    criteriaProjPriceGroup.value(relationPriceGroup);
                                    break;

                                default:
                                    criteriaProjValidFor = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjValidFor));
                                    criteriaProjValidFor.value(int2str(TableGroupAll::GroupId));
                                    break;
                            }
                            break;

                        case #displayOptionAll :

                            criteriaProjValidFor = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjValidFor));
                            criteriaProjValidFor.value(int2str(TableGroupAll::All));
                            break;
                    }
                }
                projRevenueSalesPrice_ds.query(query);
            }
            else
            {
                switch (element.args().dataset())
                {
                    case tableNum(ProjTable), tableNum(SMAAgreementTable):
                        projRevenueSalesPrice_ds.autoQuery(false);
                        query   = new Query();
                        qB      = query.addDataSource(tableNum(ProjRevenueSalesPrice));

                        criteriaProjId      = qB.addRange(fieldNum(ProjRevenueSalesPrice, ProjId));
                        projRevenueSalesPrice_ds.query(query);
                        break;
                }
            }
        }

]]></Source>
					</Method>
				</Methods>
				<Fields>
					<Field>
						<DataField>CategoryId</DataField>
						<Methods>
							<Method>
								<Name>lookup</Name>
								<Source><![CDATA[
            public void lookup(FormControl _formControl, str _filterStr)
            {
                SysTableLookup          sysTableLookup;
                Query                   query;
                QueryBuildDataSource    queryBuildDataSource;
                QueryBuildRange         queryBuildRangeIndirect;
                QueryBuildRange         queryBuildRangeRetention;
                QueryBuildRange         queryBuildRangeCategoryType;

                if (isConfigurationkeyEnabled(configurationKeyNum(Project)))
                {
                    sysTableLookup              = SysTableLookup::newParameters(tableNum(ProjCategory), _formControl);
                    query                       = new Query();
                    queryBuildDataSource        = query.addDataSource(tableNum(ProjCategory));
                    queryBuildRangeIndirect     = queryBuildDataSource.addRange(fieldNum(ProjCategory, psaIndirectComponent));
                    queryBuildRangeRetention    = queryBuildDataSource.addRange(fieldNum(ProjCategory, psaCustPaymentRetention));
                    queryBuildRangeCategoryType = queryBuildDataSource.addRange(fieldNum(ProjCategory, CategoryType));

                    queryBuildRangeIndirect.value(queryValue(NoYes::No));
                    queryBuildRangeRetention.value(queryValue(NoYes::No));
                    queryBuildRangeCategoryType.value(queryValue(ProjTransType::Revenue));

                    sysTableLookup.addLookupfield(fieldNum(ProjCategory, CategoryId));
                    sysTableLookup.addLookupfield(fieldNum(ProjCategory, Name));
                    sysTableLookup.addLookupfield(fieldNum(ProjCategory, CategoryType));

                    sysTableLookup.parmQuery(query);
                    sysTableLookup.performFormLookup();
                }
            }

]]></Source>
							</Method>
						</Methods>
					</Field>
					<Field>
						<DataField>ProjId</DataField>
						<Methods>
							<Method>
								<Name>modified</Name>
								<Source><![CDATA[
            public void modified()
            {
                super();

                // Only set the Sales Currency for a new record
                if (projRevenueSalesPrice.RecId == 0)
                {
                    projRevenueSalesPrice.CurrencyId = ProjTable::find(projRevenueSalesPrice.ProjId).currencyId();
                    projRevenueSalesPrice_ds.refresh();
                }

                if (isConfigurationkeyEnabled(configurationKeyNum(Project))
                    && projRevenueSalesPrice.ProjId != ''
                    && (projRevenueSalesPrice.psaProjInvoiceProjId != '' || projRevenueSalesPrice.psaCustAccount != ''))
                {
                    projRevenueSalesPrice.ProjId = '';
                    throw error("@PSA11510");
                }
            }

]]></Source>
							</Method>
						</Methods>
					</Field>
					<Field>
						<DataField>ProjValidFor</DataField>
						<Methods>
							<Method>
								<Name>modified</Name>
								<Source><![CDATA[
            public void modified()
            {
                super();

                element.initPriceGroupFields();
                projRevenueSalesPrice.ProjId = '';
                projRevenueSalesPrice.ProjPriceGroup = '';
            }

]]></Source>
							</Method>
						</Methods>
					</Field>
					<Field>
						<DataField>PSACustAccount</DataField>
						<Methods>
							<Method>
								<Name>modified</Name>
								<Source><![CDATA[
            public void modified()
            {
                super();
				if (isConfigurationkeyEnabled(configurationKeyNum(Project))
					&& projRevenueSalesPrice.psaCustAccount != ''
					&& (projRevenueSalesPrice.ProjId != '' || projRevenueSalesPrice.psaProjInvoiceProjId != ''))
				{
					projRevenueSalesPrice.psaCustAccount = '';
					throw error("@PSA11510");
				}
            }

]]></Source>
							</Method>
						</Methods>
					</Field>
					<Field>
						<DataField>PSAProjInvoiceProjId</DataField>
						<Methods>
							<Method>
								<Name>lookup</Name>
								<Source><![CDATA[
            public void lookup(FormControl _formControl, str _filterStr)
            {
                if (isConfigurationkeyEnabled(configurationKeyNum(Project)))
                {
                    ProjInvoiceTable::psaLookupProjInvoiceProjId(_formControl, projRevenueSalesPrice.psaCustAccount);
                }
            }

]]></Source>
							</Method>
							<Method>
								<Name>modified</Name>
								<Source><![CDATA[
            public void modified()
            {
                super();
                
				if (isConfigurationkeyEnabled(configurationKeyNum(Project))
					&& projRevenueSalesPrice.psaProjInvoiceProjId != ''
					&& (projRevenueSalesPrice.ProjId != '' || projRevenueSalesPrice.psaCustAccount != ''))
				{
					projRevenueSalesPrice.psaProjInvoiceProjId = '';
					throw error("@PSA11510");
				}
            }

]]></Source>
							</Method>
						</Methods>
					</Field>
					<Field>
						<DataField>Resource</DataField>
						<Methods>
							<Method>
								<Name>resolveReference</Name>
								<Source><![CDATA[
            /// <summary>
            /// Determines whether the input to the Resource field is a valid ResourceId or not.
            /// </summary>
            /// <param name = "_formReferenceControl">
            /// The form control that is bound to the Resource field.
            /// </param>
            /// <returns>
            /// The <c>HcmResource</c> record buffer that references the selected record.
            /// </returns>
            public Common resolveReference(FormReferenceControl _formReferenceControl)
            {
                ResourceView ret;

                ret = super(_formReferenceControl);

                if (ret.RecId && !ResourceLookup::validateResource(ret.RecId, projRevenueSalesPrice))
                {
                    ret = null;
                }

                return ret;
            }

]]></Source>
							</Method>
							<Method>
								<Name>lookupReference</Name>
								<Source><![CDATA[
            /// <summary>
            /// Opens the resource lookup.
            /// </summary>
            /// <param name = "_formReferenceControl">
            /// The form control that is bound to the Resource field.
            /// </param>
            /// <returns>
            /// The <c>HcmResource</c> record buffer that references the selected record.
            /// </returns>
            public Common lookupReference(FormReferenceControl _formReferenceControl)
            {
                return ResourceLookup::lookupResource(_formReferenceControl, projRevenueSalesPrice);
            }

]]></Source>
							</Method>
						</Methods>
					</Field>
				</Fields>
			</DataSource>
		</DataSources>
		<DataControls xmlns="">
			<Control>
				<Name>DisplayOption</Name>
				<Type>ComboBox</Type>
				<Methods>
					<Method>
						<Name>modified</Name>
						<Source><![CDATA[
        public boolean modified()
        {
            boolean ret;
            ret = super();
            element.reSelect();
            CategoryQuickFilter.applyFilter();
            return ret;
        }

]]></Source>
					</Method>
				</Methods>
			</Control>
		</DataControls>
		<Members xmlns="" />
	</SourceCode>
	<DataSources>
		<AxFormDataSource xmlns="">
			<Name>ProjRevenueSalesPrice</Name>
			<Table>ProjRevenueSalesPrice</Table>
			<Fields>
				<AxFormDataSourceField>
					<DataField>CategoryId</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>Contract</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>CurrencyId</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>DataAreaId</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>Partition</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>ProjId</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>ProjPriceGroup</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>ProjValidFor</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>PSACustAccount</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>PSAProjInvoiceProjId</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>RecId</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>Resource</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>ResourceCategory</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>SalesPrice</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>TableId</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>TransDate</DataField>
				</AxFormDataSourceField>
				<AxFormDataSourceField>
					<DataField>Worker</DataField>
				</AxFormDataSourceField>
			</Fields>
			<ReferencedDataSources />
			<InsertIfEmpty>No</InsertIfEmpty>
			<DataSourceLinks />
			<DerivedDataSources />
		</AxFormDataSource>
	</DataSources>
	<Design>
		<Caption xmlns="">@SYS78792</Caption>
		<DataSource xmlns="">ProjRevenueSalesPrice</DataSource>
		<Pattern xmlns="">SimpleList</Pattern>
		<PatternVersion xmlns="">1.1</PatternVersion>
		<Style xmlns="">SimpleList</Style>
		<TitleDataSource xmlns="">ProjRevenueSalesPrice</TitleDataSource>
		<Controls xmlns="">
			<AxFormControl xmlns=""
				i:type="AxFormActionPaneControl">
				<Name>ActionPane</Name>
				<ElementPosition>715827882</ElementPosition>
				<FilterExpression>%1</FilterExpression>
				<Type>ActionPane</Type>
				<VerticalSpacing>-1</VerticalSpacing>
				<FormControlExtension
					i:nil="true" />
				<Controls />
				<AlignChild>No</AlignChild>
				<AlignChildren>No</AlignChildren>
				<ArrangeMethod>Vertical</ArrangeMethod>
			</AxFormControl>
			<AxFormControl xmlns=""
				i:type="AxFormGroupControl">
				<Name>TopGroup</Name>
				<AutoDeclaration>Yes</AutoDeclaration>
				<ElementPosition>1193046470</ElementPosition>
				<FilterExpression>%1</FilterExpression>
				<Pattern>CustomAndQuickFilters</Pattern>
				<PatternVersion>1.1</PatternVersion>
				<Type>Group</Type>
				<VerticalSpacing>-1</VerticalSpacing>
				<WidthMode>SizeToAvailable</WidthMode>
				<FormControlExtension
					i:nil="true" />
				<Controls>
					<AxFormControl>
						<Name>CategoryQuickFilter</Name>
						<AutoDeclaration>Yes</AutoDeclaration>
						<FormControlExtension>
							<Name>QuickFilterControl</Name>
							<ExtensionComponents />
							<ExtensionProperties>
								<AxFormControlExtensionProperty>
									<Name>targetControlName</Name>
									<Type>String</Type>
									<Value>Grid</Value>
								</AxFormControlExtensionProperty>
								<AxFormControlExtensionProperty>
									<Name>defaultColumnName</Name>
									<Type>String</Type>
									<Value>ProjRevenueSalesPrice_CategoryId</Value>
								</AxFormControlExtensionProperty>
								<AxFormControlExtensionProperty>
									<Name>placeholderText</Name>
									<Type>String</Type>
								</AxFormControlExtensionProperty>
							</ExtensionProperties>
						</FormControlExtension>
					</AxFormControl>
					<AxFormControl xmlns=""
						i:type="AxFormGroupControl">
						<Name>CustomFilter</Name>
						<Type>Group</Type>
						<FormControlExtension
							i:nil="true" />
						<Controls>
							<AxFormControl xmlns=""
								i:type="AxFormComboBoxControl">
								<Name>DisplayOption</Name>
								<AutoDeclaration>Yes</AutoDeclaration>
								<ConfigurationKey>PriceDisc</ConfigurationKey>
								<ElementPosition>1073741822</ElementPosition>
								<FilterExpression>%1</FilterExpression>
								<Type>ComboBox</Type>
								<VerticalSpacing>-1</VerticalSpacing>
								<FormControlExtension
									i:nil="true" />
								<ComboType>List</ComboType>
								<Label>@Proj:Display</Label>
								<ShowLabel>No</ShowLabel>
								<Items />
							</AxFormControl>
							<AxFormControl xmlns=""
								i:type="AxFormStringControl">
								<Name>Relation</Name>
								<AllowEdit>No</AllowEdit>
								<AutoDeclaration>Yes</AutoDeclaration>
								<ConfigurationKey>PriceDisc</ConfigurationKey>
								<ElementPosition>1610612733</ElementPosition>
								<FilterExpression>%1</FilterExpression>
								<Skip>Yes</Skip>
								<Type>String</Type>
								<VerticalSpacing>-1</VerticalSpacing>
								<FormControlExtension
									i:nil="true" />
								<Label>@SYS9114</Label>
								<ShowLabel>No</ShowLabel>
							</AxFormControl>
						</Controls>
						<ArrangeMethod>HorizontalLeft</ArrangeMethod>
					</AxFormControl>
				</Controls>
				<AlignChild>No</AlignChild>
				<ArrangeMethod>HorizontalLeft</ArrangeMethod>
				<FrameType>None</FrameType>
				<Style>CustomFilter</Style>
				<ViewEditMode>Edit</ViewEditMode>
			</AxFormControl>
			<AxFormControl xmlns=""
				i:type="AxFormGridControl">
				<Name>Grid</Name>
				<ElementPosition>715827882</ElementPosition>
				<FilterExpression>%1</FilterExpression>
				<Type>Grid</Type>
				<VerticalSpacing>-1</VerticalSpacing>
				<FormControlExtension
					i:nil="true" />
				<Controls>
					<AxFormControl xmlns=""
						i:type="AxFormDateControl">
						<Name>ProjRevenueSalesPrice_TransDate</Name>
						<ElementPosition>429496728</ElementPosition>
						<FilterExpression>%1</FilterExpression>
						<HeightMode>Auto</HeightMode>
						<Type>Date</Type>
						<VerticalSpacing>-1</VerticalSpacing>
						<WidthMode>Auto</WidthMode>
						<FormControlExtension
							i:nil="true" />
						<DataField>TransDate</DataField>
						<DataSource>ProjRevenueSalesPrice</DataSource>
						<DisplayLength>15</DisplayLength>
						<DisplayLengthMode>Fixed</DisplayLengthMode>
					</AxFormControl>
					<AxFormControl xmlns=""
						i:type="AxFormStringControl">
						<Name>ProjRevenueSalesPrice_CategoryId</Name>
						<ElementPosition>644245092</ElementPosition>
						<FilterExpression>%1</FilterExpression>
						<HeightMode>Auto</HeightMode>
						<Type>String</Type>
						<VerticalSpacing>-1</VerticalSpacing>
						<WidthMode>Auto</WidthMode>
						<FormControlExtension
							i:nil="true" />
						<DataField>CategoryId</DataField>
						<DataSource>ProjRevenueSalesPrice</DataSource>
					</AxFormControl>
					<AxFormControl xmlns=""
						i:type="AxFormReferenceGroupControl">
						<Name>ProjRevenueSalesPrice_Resource</Name>
						<HeightMode>Auto</HeightMode>
						<Type>ReferenceGroup</Type>
						<WidthMode>Auto</WidthMode>
						<FormControlExtension
							i:nil="true" />
						<Controls />
						<DataSource>ProjRevenueSalesPrice</DataSource>
						<ReferenceField>Resource</ReferenceField>
						<ReplacementFieldGroup>ResourceId</ReplacementFieldGroup>
					</AxFormControl>
					<AxFormControl xmlns=""
						i:type="AxFormComboBoxControl">
						<Name>ProjRevenueSalesPrice_ProjValidFor</Name>
						<ElementPosition>1073741820</ElementPosition>
						<FilterExpression>%1</FilterExpression>
						<HeightMode>Auto</HeightMode>
						<Type>ComboBox</Type>
						<VerticalSpacing>-1</VerticalSpacing>
						<WidthMode>Auto</WidthMode>
						<FormControlExtension
							i:nil="true" />
						<DataField>ProjValidFor</DataField>
						<DataSource>ProjRevenueSalesPrice</DataSource>
						<DisplayLength>15</DisplayLength>
						<DisplayLengthMode>Fixed</DisplayLengthMode>
						<Items />
					</AxFormControl>
					<AxFormControl xmlns=""
						i:type="AxFormStringControl">
						<Name>ProjRevenueSalesPrice_ProjId</Name>
						<ElementPosition>1288490184</ElementPosition>
						<FilterExpression>%1</FilterExpression>
						<HeightMode>Auto</HeightMode>
						<Type>String</Type>
						<VerticalSpacing>-1</VerticalSpacing>
						<WidthMode>Auto</WidthMode>
						<FormControlExtension
							i:nil="true" />
						<DataField>ProjId</DataField>
						<DataSource>ProjRevenueSalesPrice</DataSource>
					</AxFormControl>
					<AxFormControl xmlns=""
						i:type="AxFormStringControl">
						<Name>ProjRevenueSalesPrice_PSAProjInvoiceProjId</Name>
						<ElementPosition>1342177278</ElementPosition>
						<FilterExpression>%1</FilterExpression>
						<HeightMode>Auto</HeightMode>
						<Type>String</Type>
						<VerticalSpacing>-1</VerticalSpacing>
						<WidthMode>Auto</WidthMode>
						<FormControlExtension
							i:nil="true" />
						<DataField>PSAProjInvoiceProjId</DataField>
						<DataSource>ProjRevenueSalesPrice</DataSource>
					</AxFormControl>
					<AxFormControl xmlns=""
						i:type="AxFormStringControl">
						<Name>ProjRevenueSalesPrice_PSACustAccount</Name>
						<ElementPosition>1476395006</ElementPosition>
						<FilterExpression>%1</FilterExpression>
						<HeightMode>Auto</HeightMode>
						<Type>String</Type>
						<VerticalSpacing>-1</VerticalSpacing>
						<WidthMode>Auto</WidthMode>
						<FormControlExtension
							i:nil="true" />
						<DataField>PSACustAccount</DataField>
						<DataSource>ProjRevenueSalesPrice</DataSource>
					</AxFormControl>
					<AxFormControl xmlns=""
						i:type="AxFormStringControl">
						<Name>ProjRevenueSalesPrice_PriceGroup</Name>
						<ElementPosition>1503238548</ElementPosition>
						<FilterExpression>%1</FilterExpression>
						<HeightMode>Auto</HeightMode>
						<Type>String</Type>
						<VerticalSpacing>-1</VerticalSpacing>
						<WidthMode>Auto</WidthMode>
						<FormControlExtension
							i:nil="true" />
						<DataField>ProjPriceGroup</DataField>
						<DataSource>ProjRevenueSalesPrice</DataSource>
					</AxFormControl>
					<AxFormControl xmlns=""
						i:type="AxFormStringControl">
						<Name>ProjRevenueSalesPrice_CurrencyId</Name>
						<ElementPosition>1717986912</ElementPosition>
						<FilterExpression>%1</FilterExpression>
						<HeightMode>Auto</HeightMode>
						<Type>String</Type>
						<VerticalSpacing>-1</VerticalSpacing>
						<WidthMode>Auto</WidthMode>
						<FormControlExtension
							i:nil="true" />
						<DataField>CurrencyId</DataField>
						<DataSource>ProjRevenueSalesPrice</DataSource>
						<DisplayLength>10</DisplayLength>
						<DisplayLengthMode>Fixed</DisplayLengthMode>
					</AxFormControl>
					<AxFormControl xmlns=""
						i:type="AxFormRealControl">
						<Name>ProjRevenueSalesPrice_ProjSalesPricing</Name>
						<ElementPosition>1932735276</ElementPosition>
						<FilterExpression>%1</FilterExpression>
						<HeightMode>Auto</HeightMode>
						<HelpText>@FieldDescriptions_ProjectManagementAndAccounting:ProjSalesPriceRevenue_ProjRevenueSalesPrice_ProjSalesPricing</HelpText>
						<Type>Real</Type>
						<VerticalSpacing>-1</VerticalSpacing>
						<WidthMode>Auto</WidthMode>
						<FormControlExtension
							i:nil="true" />
						<DataField>SalesPrice</DataField>
						<DataSource>ProjRevenueSalesPrice</DataSource>
						<NoOfDecimals>-1</NoOfDecimals>
					</AxFormControl>
				</Controls>
				<AlternateRowShading>No</AlternateRowShading>
				<DataSource>ProjRevenueSalesPrice</DataSource>
				<Style>Tabular</Style>
			</AxFormControl>
		</Controls>
	</Design>
	<Parts />
</AxForm>