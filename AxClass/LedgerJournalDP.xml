<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>LedgerJournalDP</Name>
	<SourceCode>
		<Declaration><![CDATA[
/// <summary>
///    The <c>LedgerJournalDP</c> class declares the variables, tables, and so on, that are used in the
///    <c>LedgerJournal</c> report.
/// </summary>
[
    SRSReportQueryAttribute(queryStr(LedgerJournal)),
    SRSReportParameterAttribute(classStr(LedgerJournalContract))
]
public class LedgerJournalDP extends SrsReportDataProviderPreProcessTempDB
{
    // <GEEU>
    #ISOCountryRegionCodes
    #EECountryRegionCodes

    boolean isEECountryActive;
    // </GEEU>
    LedgerJournalTmp ledgerJournalTmp;
    LedgerJournalTableTmp ledgerJournalTableTmp;
    LedgerJournalReportCaptionsTmp ledgerJournalReportCaptionsTmp;
    RecordInsertList recordInsertList;

    DiscAmount cashDiscAmount;

    private static const str UseOldLedgerJournalDPReportFlight = 'LedgerJournal_UseOldLegerJournalDPReport';
    private boolean isFlightEnabled;

}
]]></Declaration>
		<Methods>
			<Method>
				<Name>setIsFlightEnabled</Name>
				<Source><![CDATA[
    private void setIsFlightEnabled()
    {
        this.isFlightEnabled = Global::isFlightEnabled(UseOldLedgerJournalDPReportFlight);
    }

]]></Source>
			</Method>
			<Method>
				<Name>getLedgerJournalTmp</Name>
				<Source><![CDATA[
    /// <summary>
    /// Gets the <c>LedgerJournalTmp</c> temporary table.
    /// </summary>
    /// <returns>
    /// The <c>LedgerJournalTmp</c> temporary table.
    /// </returns>
    [
        SRSReportDataSetAttribute(tableStr(LedgerJournalTmp))
    ]
    public LedgerJournalTmp getLedgerJournalTmp()
    {
        select ledgerJournalTmp;
        return ledgerJournalTmp;
    }

]]></Source>
			</Method>
			<Method>
				<Name>getLedgerJournalTableTmp</Name>
				<Source><![CDATA[
    /// <summary>
    /// Gets the <c>LedgerJournalTableTmp</c> temporary table.
    /// </summary>
    /// <returns>
    /// The <c>LedgerJournalTableTmp</c> temporary table.
    /// </returns>
    [
        SRSReportDataSetAttribute(tableStr(LedgerJournalTableTmp)),
        Hookable(false)
    ]
    public LedgerJournalTableTmp getLedgerJournalTableTmp()
    {
        select ledgerJournalTableTmp;
        return ledgerJournalTableTmp;
    }

]]></Source>
			</Method>
			<Method>
				<Name>getLedgerJournalReportCaptionsTmp</Name>
				<Source><![CDATA[
    /// <summary>
    /// Gets the <c>LedgerJournalReportCaptionsTmp</c> temporary table.
    /// </summary>
    /// <returns>
    /// The <c>LedgerJournalReportCaptionsTmp</c> temporary table.
    /// </returns>
    [
        SRSReportDataSetAttribute(tableStr(LedgerJournalReportCaptionsTmp)),
        Hookable(false)
    ]
    public LedgerJournalReportCaptionsTmp getLedgerJournalReportCaptionsTmp()
    {
        select ledgerJournalReportCaptionsTmp;
        return ledgerJournalReportCaptionsTmp;
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertAccrualTransactions</Name>
				<Source><![CDATA[
    private void insertAccrualTransactions()
    {
        LedgerJournalTmp ledgerJournalTmpJoin;
        LedgerJournalTransAccrual ledgerJournalTransAccrual;
        LedgerJournalTransAccrualTrans ledgerJournalTransAccrualTrans;

        NoYes accrualRecordMarked = NoYes::Yes;

        this.takeOwnershipOfTempTable(ledgerJournalTmpJoin);
        ledgerJournalTmpJoin.linkPhysicalTableInstance(ledgerJournalTmp);

        // Add accrualID for the journal lines
        update_recordSet ledgerJournalTmp
            setting AccrualId = ledgerJournalTransAccrual.AccrualId
        join ledgerJournalTransAccrual
            where ledgerJournalTransAccrual.RefTableId == tableNum(LedgerJournalTrans)
                && ledgerJournalTransAccrual.RefRecid == ledgerJournalTmp.LedgerJournalTransRecId
                && ledgerJournalTransAccrual.AccountOffsetaccount == ledgerJournalTmp.AccountOffsetaccount;

        this.updateLedgerDimensionForAccrualTrans();

        // Insert accrual detail records
        insert_recordset ledgerJournalTmp
        (
            IsAccrualRecord,
            LedgerJournalType,
            JournalNum,
            JournalName,
            Name,
            ReportedAsReadyBy,
            RejectedBy,
            Posted,
            PostedDateTime,
            Log,
            ReportCaption,
            Company,
            AccountType,
            CurrencyCode,
            Voucher,
            Invoice,
            LastTransferred,
            FreqCode,
            FreqValue,
            Due,
            PaymId,
            Approved,
            Approver,
            PaymSpec,
            PaymMode,
            BankTransType,
            PaymReference,
            BankDepositNum,
            BankDepositVoucher,
            RemittanceAddressRecID,
            AccountOffsetaccount,
            // from accrual
            LedgerAccountLedgerDimension,
            Txt,
            TotalAmountSumDebit,
            TransDate
        )
        select
            accrualRecordMarked,
            LedgerJournalType,
            JournalNum,
            JournalName,
            Name,
            ReportedAsReadyBy,
            RejectedBy,
            Posted,
            PostedDateTime,
            Log,
            ReportCaption,
            Company,
            AccountType,
            CurrencyCode,
            Voucher,
            Invoice,
            LastTransferred,
            FreqCode,
            FreqValue,
            Due,
            PaymId,
            Approved,
            Approver,
            PaymSpec,
            PaymMode,
            BankTransType,
            PaymReference,
            BankDepositNum,
            BankDepositVoucher,
            RemittanceAddressRecID,
            AccountOffsetaccount
        from ledgerJournalTmpJoin
        join LedgerDimension,
            TransTxt,
            AmountCur,
            DocumentDate
        from ledgerJournalTransAccrualTrans
            where ledgerJournalTransAccrualTrans.RefTableid == tableNum(LedgerJournalTrans)
                && ledgerJournalTransAccrualTrans.RefRecid == ledgerJournalTmpJoin.LedgerJournalTransRecId
        exists join ledgerJournalTransAccrual
            where ledgerJournalTransAccrual.RefTableid == tableNum(LedgerJournalTrans)
                && ledgerJournalTransAccrual.RefRecid == ledgerJournalTmpJoin.LedgerJournalTransRecId
                && LedgerJournalTransAccrual.AccountOffsetaccount == ledgerJournalTmpJoin.AccountOffsetaccount;

        update_recordSet ledgerJournalTmp
            setting TotalAmountSumCredit = 0 - ledgerJournalTmp.TotalAmountSumDebit,
                TotalAmountSumDebit = 0
           where ledgerJournalTmp.TotalAmountSumDebit < 0
            && ledgerJournalTmp.IsAccrualRecord == NoYes::Yes;
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertLedgerJournalTmp</Name>
				<Source><![CDATA[
    /// <summary>
    /// Creates a new <c>LedgerJournalTmp</c> record.
    /// </summary>
    /// <param name = "_ledgerJournalTable">
    /// A <c>LedgerJournalTable</c> table buffer.
    /// </param>
    /// <param name = "_ledgerJournalTrans">
    /// A <c>LedgerJournalTrans</c> table buffer.
    /// </param>
    /// <param name = "_accountOffsetAccount">
    /// A <c>AccountOffsetaccount</c> enumeration value.
    /// </param>
    [SysObsolete('This method will be deprecated in a future release. Use insertTransactionsFromLedgerJournalTrans() and insertOffsetTransactions() instead.', false, 30\06\2020)]
    protected void insertLedgerJournalTmp(
        LedgerJournalTable _ledgerJournalTable,
        LedgerJournalTrans _ledgerJournalTrans,
        AccountOffsetaccount _accountOffsetAccount = AccountOffsetaccount::Account)
    {
        ledgerJournalTmp = this.populateLedgerJournalTmp(_ledgerJournalTable, _ledgerJournalTrans, _accountOffsetAccount);
        recordInsertList.add(ledgerJournalTmp);
    }

]]></Source>
			</Method>
			<Method>
				<Name>populateLedgerJournalTmp</Name>
				<Source><![CDATA[
    /// <summary>
    /// Populates the <c>LedgerJournalTmp</c> table buffer.
    /// </summary>
    /// <param name = "_ledgerJournalTable">
    /// A <c>LedgerJournalTable</c> table buffer.
    /// </param>
    /// <param name = "_ledgerJournalTrans">
    /// A <c>LedgerJournalTrans</c> table buffer.
    /// </param>
    /// <param name = "_accountOffsetAccount">
    /// A <c>AccountOffsetaccount</c> enumeration value.
    /// </param>
    /// <returns>
    /// The <c>LedgerJournalTmp</c> table buffer.
    /// </returns>
    [SysObsolete('This method will be deprecated in a future release.', false, 30\06\2020)]
    protected LedgerJournalTmp populateLedgerJournalTmp(
        LedgerJournalTable _ledgerJournalTable,
        LedgerJournalTrans _ledgerJournalTrans,
        AccountOffsetaccount _accountOffsetAccount)
    {
        ledgerJournalTmp.clear();

        boolean isoffset = (_accountOffsetAccount == AccountOffsetaccount::Account) ? false : true;
        ledgerJournalTmp.LedgerJournalType = _ledgerJournalTable.JournalType;
        ledgerJournalTmp.JournalNum = _ledgerJournalTable.JournalNum;
        ledgerJournalTmp.JournalName = _ledgerJournalTable.JournalName;
        ledgerJournalTmp.Name = _ledgerJournalTable.Name;
        ledgerJournalTmp.ReportedAsReadyBy = _ledgerJournalTable.ReportedAsReadyBy;
        ledgerJournalTmp.RejectedBy = _ledgerJournalTable.RejectedBy;
        ledgerJournalTmp.Posted = _ledgerJournalTable.Posted;
        ledgerJournalTmp.PostedDateTime = _ledgerJournalTable.PostedDateTime;
        ledgerJournalTmp.Log = _ledgerJournalTable.Log;
        ledgerJournalTmp.ReportCaption = this.setReportName(_ledgerJournalTable.JournalType);

        ledgerJournalTmp.LedgerDimension = _ledgerJournalTrans.LedgerDimension;
        ledgerJournalTmp.Company = _ledgerJournalTrans.Company;
        ledgerJournalTmp.AccountType = _ledgerJournalTrans.AccountType;
        ledgerJournalTmp.LedgerAccountLedgerDimension = _ledgerJournalTrans.getLedgerDimensionForJournalAccount(_ledgerJournalTable, isoffset);
        ledgerJournalTmp.CurrencyCode = _ledgerJournalTrans.CurrencyCode;
        ledgerJournalTmp.Voucher = _ledgerJournalTrans.Voucher;
        ledgerJournalTmp.Invoice = _ledgerJournalTrans.Invoice;
        ledgerJournalTmp.TransDate = _ledgerJournalTrans.TransDate;
        ledgerJournalTmp.LastTransferred = _ledgerJournalTrans.LastTransferred;
        ledgerJournalTmp.FreqCode = _ledgerJournalTrans.FreqCode;
        ledgerJournalTmp.FreqValue = _ledgerJournalTrans.FreqValue;
        ledgerJournalTmp.Due = _ledgerJournalTrans.Due;
        ledgerJournalTmp.CashDiscAmount = cashDiscAmount;
        ledgerJournalTmp.DateCashDisc = _ledgerJournalTrans.DateCashDisc;
        ledgerJournalTmp.PaymId = _ledgerJournalTrans.PaymId;
        ledgerJournalTmp.Approved = _ledgerJournalTrans.Approved;
        ledgerJournalTmp.Approver = _ledgerJournalTrans.Approver;
        ledgerJournalTmp.PaymSpec = _ledgerJournalTrans.PaymSpec;
        ledgerJournalTmp.PaymMode = _ledgerJournalTrans.PaymMode;
        ledgerJournalTmp.BankTransType = _ledgerJournalTrans.BankTransType;
        ledgerJournalTmp.PaymReference = _ledgerJournalTrans.PaymReference;
        ledgerJournalTmp.BankDepositNum = _ledgerJournalTrans.BankDepositNum;
        ledgerJournalTmp.BankDepositVoucher = _ledgerJournalTrans.BankDepositVoucher;
        ledgerJournalTmp.Txt = _ledgerJournalTrans.Txt;
        ledgerJournalTmp.TotalAmountSumCredit = _ledgerJournalTrans.AmountCurCredit;
        ledgerJournalTmp.TotalAmountSumDebit = _ledgerJournalTrans.AmountCurDebit;
        ledgerJournalTmp.RemittanceAddressRecID = _ledgerJournalTrans.RemittanceAddress;
        ledgerJournalTmp.Invoice = _ledgerJournalTrans.Invoice;
        ledgerJournalTmp.LedgerJournalTransRecId = _ledgerJournalTrans.RecId;
        ledgerJournalTmp.DefaultDimension = _ledgerJournalTrans.DefaultDimension;
        ledgerJournalTmp.OffsetDefaultDimension = _ledgerJournalTrans.OffsetDefaultDimension;
        ledgerJournalTmp.PostingProfile = _ledgerJournalTrans.PostingProfile;

        ledgerJournalTmp.IsAccrualRecord = NoYes::No;
        ledgerJournalTmp.AccountOffsetaccount = _accountOffsetAccount;

        return ledgerJournalTmp;
    }

]]></Source>
			</Method>
			<Method>
				<Name>ledgerJournalTransOffset</Name>
				<Source><![CDATA[
    /// <summary>
    /// Gets the <c>LedgerjournalTrans</c> offset records.
    /// </summary>
    /// <param name="_ledgerJournalTrans">
    /// A <c>LedgerJournalTrans</c> record.
    /// </param>
    /// <returns>
    /// <c>LedgerJournalTrans</c> Offset records.
    /// </returns>
    private LedgerJournalTrans ledgerJournalTransOffset(LedgerJournalTrans _ledgerJournalTrans)
    {
        AmountCur amountCurLocal;

        if (_ledgerJournalTrans.parmOffsetLedgerDimension())
        {
            if (_ledgerJournalTrans.ledgerJournalTable().LedgerJournalInclTax)
            {
                if (!(_ledgerJournalTrans.AccountType != LedgerJournalACType::Ledger &&
                      _ledgerJournalTrans.AccountType != LedgerJournalACType::Project &&
                     (_ledgerJournalTrans.OffsetAccountType == LedgerJournalACType::Ledger ||
                      _ledgerJournalTrans.OffsetAccountType == LedgerJournalACType::Project)))
                {
                    _ledgerJournalTrans.TaxGroup = '';
                    _ledgerJournalTrans.TaxItemGroup = '';
                    _ledgerJournalTrans.TaxCode = '';
                }
            }
            else
            {
                if ((_ledgerJournalTrans.AccountType == LedgerJournalACType::Ledger       ||
                     _ledgerJournalTrans.AccountType == LedgerJournalACType::Project)     &&
                    (_ledgerJournalTrans.OffsetAccountType == LedgerJournalACType::Ledger ||
                     _ledgerJournalTrans.OffsetAccountType == LedgerJournalACType::Project))
                {
                    _ledgerJournalTrans.TaxGroup = '';
                    _ledgerJournalTrans.TaxItemGroup = '';
                    _ledgerJournalTrans.TaxCode = '';
                }
            }
            _ledgerJournalTrans.parmLedgerDimension(_ledgerJournalTrans.parmOffsetLedgerDimension());
            _ledgerJournalTrans.parmDefaultDimension(_ledgerJournalTrans.parmOffsetDefaultDimension());
            _ledgerJournalTrans.AccountType = _ledgerJournalTrans.OffsetAccountType;
            _ledgerJournalTrans.Company = _ledgerJournalTrans.OffsetCompany ? _ledgerJournalTrans.OffsetCompany : _ledgerJournalTrans.Company;
            _ledgerJournalTrans.Txt = _ledgerJournalTrans.OffsetTxt ? _ledgerJournalTrans.OffsetTxt : _ledgerJournalTrans.Txt;
            amountCurLocal = _ledgerJournalTrans.AmountCurDebit;
            _ledgerJournalTrans.AmountCurDebit = _ledgerJournalTrans.AmountCurCredit;
            _ledgerJournalTrans.AmountCurCredit = amountCurLocal;
            // <GEEU>
            if (isEECountryActive)
            {
                _ledgerJournalTrans.PostingProfile = _ledgerJournalTrans.OffsetPostingProfile_RU;
            }
            // </GEEU>
            _ledgerJournalTrans.parmOffsetLedgerDimension(0);
        }
        else
        {
            _ledgerJournalTrans.parmLedgerDimension(0);
            _ledgerJournalTrans.AmountCurDebit = 0;
            _ledgerJournalTrans.AmountCurCredit = 0;
        }

        return _ledgerJournalTrans;
    }

]]></Source>
			</Method>
			<Method>
				<Name>processReport</Name>
				<Source><![CDATA[
    /// <summary>
    /// Processes the report business logic.
    /// </summary>
    /// <remarks>
    /// Provides the ability to write the report business logic. This method will be called by  at runtime.
    /// The method should compute data and populate the data tables that will be returned to . This is a
    /// framework class. Customizing this class may cause problems with future upgrades to the software.
    /// </remarks>
    public void processReport()
    {
        boolean journalTableOnly = false;

        this.setIsFlightEnabled();
        
        this.takeOwnershipOfTempTable(ledgerJournalTmp);
        this.takeOwnershipOfTempTable(ledgerJournalReportCaptionsTmp);

        LedgerJournalContract contract = this.parmDataContract() as LedgerJournalContract;
        NoYes showAccrualTrans = contract.parmShowAccrualTrans();
        Query query = this.parmQuery();

        // If no user-defined ranges have been provided, query only the LedgerJournalTable
        // records because the LedgerJournalTrans records will be added later with a set-based operation
        if (!SysQuery::queryHasRangesOrFilters(query, true))
        {
            journalTableOnly = true;
            query.dataSourceTable(tableNum(LedgerJournalTrans)).enabled(false);
            query.clearOrderBy();
        }
                
        this.parmUserConnection().ttsbegin();

        this.populateLedgerJournalReportCaptionsTmp();

        using (SysInstrumentationActivityContext activityContext = this.logProcessReport(contract, query))
        {
            if (journalTableOnly)
            {
                this.processReportForJournalTable(query);
            }
            else
            {
                this.processReportForJournalTableAndTrans(query);
            }

            this.updateLedgerDimensionFromPostingProfile();

            if (showAccrualTrans)
            {
                this.insertAccrualTransactions();
            }

            this.updateAccountNum();

            this.updateForLedgerAccounts();

            this.updateCustomerAccounts();
            this.updateVendorAccounts();
            this.updateBankAccounts();

            this.updateProjectAccounts();

            this.updateFixedAssetsAccounts();

            // <GEERU>
            isEECountryActive = this.isEECountryActive();
            if (SysCountryRegionCode::isLegalEntityInCountryRegion([#isoRU]) || isEECountryActive)
            {
                this.updateForLocalization();
            }
            // </GEERU>

            this.updateApprover();

            this.updateRemittanceAddress();
        }

        this.parmUserConnection().ttscommit();
    }

]]></Source>
			</Method>
			<Method>
				<Name>isEECountryActive</Name>
				<Source><![CDATA[
    /// <summary>
    /// Extension point for country/region check.
    /// </summary>
    /// <returns>True if EE country/region functionality must be activated.</returns>
    protected boolean isEECountryActive()
    {   
        return SysCountryRegionCode::isLegalEntityInCountryRegion(#easternEuropeAll);
    }

]]></Source>
			</Method>
			<Method>
				<Name>processReportForJournalTable</Name>
				<Source><![CDATA[
    private void processReportForJournalTable(Query _query)
    {
        LedgerJournalTable ledgerJournalTable;

        if (this.isFlightEnabled)
        {
            QueryRun queryRun = new QueryRun(_query);

            while (queryRun.next())
            {
                ledgerJournalTable = queryRun.get(tableNum(LedgerJournalTable)) as LedgerJournalTable;

                this.insertJournalTransForLedgerJournalTable(ledgerJournalTable);
            }
        }
        else
        {
            Map ledgerJournalTableInsertMap = new Map(Types::String, Types::Container);

            QueryBuildDataSource ledgerJournalTableDataSource = _query.dataSourceTable(tableNum(LedgerJournalTable));

            if (!ledgerJournalTableDataSource)
            {
                throw error(Error::wrongUseOfFunction(funcName()));
            }

            _query.clearAllFields();

            this.mapLedgerJournalTableIntoLedgerJournalTableTmp(ledgerJournalTableDataSource, ledgerJournalTableInsertMap);

            Query::insert_recordset(ledgerJournalTableTmp, ledgerJournalTableInsertMap, _query);
                        
            this.updateReportCaptionsOnLedgerJournalTableTmp();

            this.insertInfoFromLedgerJournalTrans();
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>processReportForJournalTableAndTrans</Name>
				<Source><![CDATA[
    private void processReportForJournalTableAndTrans(Query _query)
    {
        // Skip AOS Validation so that insert and subsequent updates don't revert to row-by-row.
        new SkipAOSValidationPermission().assert();

        if (this.isFlightEnabled)
        {
            recordInsertList = new RecordInsertList(tableNum(LedgerJournalTmp), true, true, true, true, true, LedgerJournalTmp);
            QueryRun queryRun = new QueryRun(_query);

            while (queryRun.next())
            {
                LedgerJournalTable ledgerJournalTable = queryRun.get(tableNum(LedgerJournalTable)) as LedgerJournalTable;
                LedgerJournalTrans ledgerJournalTrans = queryRun.get(tableNum(LedgerJournalTrans)) as LedgerJournalTrans;
                cashDiscAmount = ledgerJournalTrans.CashDiscAmount;

                // primary account
                this.insertLedgerJournalTmp(ledgerJournalTable, ledgerJournalTrans, AccountOffsetaccount::Account);

                // Process the offset if one has been entered.
                ledgerJournalTrans = this.ledgerJournalTransOffset(ledgerJournalTrans);

                if (ledgerJournalTrans.parmLedgerDimension())
                {
                    // cash discount is only shown with the main account and never the offset
                    cashDiscAmount = 0;
                    // offset account
                    this.insertLedgerJournalTmp(ledgerJournalTable, ledgerJournalTrans, AccountOffsetaccount::OffsetAccount);
                }
            }
            recordInsertList.insertDatabase();
        }
        else
        {
            Map ledgerJournalTmpInsertMap = new Map(Types::String, Types::Container);

            QueryBuildDataSource ledgerJournalTableDataSource = _query.dataSourceTable(tableNum(LedgerJournalTable));
            QueryBuildDataSource ledgerJournalTransDataSource = _query.dataSourceTable(tableNum(LedgerJournalTrans));

            if (!ledgerJournalTableDataSource || !ledgerJournalTransDataSource)
            {
                throw error(Error::wrongUseOfFunction(funcName()));
            }

            _query.clearAllFields();

            this.mapLedgerJournalTableIntoLegerJournalTmp(ledgerJournalTableDataSource, ledgerJournalTmpInsertMap);
            this.mapLedgerJournalTransIntoLegerJournalTmp(ledgerJournalTransDataSource, ledgerJournalTmpInsertMap);

            Query::insert_recordset(ledgerJournalTmp, ledgerJournalTmpInsertMap, _query);
            
            // some fields can't be mapped due to pattern limitation. Update them in the next step.
            this.updateTheRestOfFields();

            this.insertOffsetTransactions();
        }

        CodeAccessPermission::revertAssert();
    }

]]></Source>
			</Method>
			<Method>
				<Name>mapLedgerJournalTableIntoLedgerJournalTableTmp</Name>
				<Source><![CDATA[
    private void mapLedgerJournalTableIntoLedgerJournalTableTmp(QueryBuildDataSource _ledgerJournalTableDataSource, Map _insertMap)
    {
        int ledgerJournalTableDataSourceUniqueId = _ledgerJournalTableDataSource.uniqueId();

        this.addLedgerJournalTableFields(_ledgerJournalTableDataSource);
 
        _insertMap.insert(
            fieldStr(LedgerJournalTableTmp, JournalType),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, JournalType)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTableTmp, JournalNum),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, JournalNum)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTableTmp, JournalName),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, JournalName)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTableTmp, Name),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, Name)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTableTmp, ReportedAsReadyBy),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, ReportedAsReadyBy)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTableTmp, RejectedBy),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, RejectedBy)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTableTmp, Posted),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, Posted)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTableTmp, PostedDateTime),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, PostedDateTime)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTableTmp, Log),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, Log)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTableTmp, Approver),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, Approver)]);
    }

]]></Source>
			</Method>
			<Method>
				<Name>mapLedgerJournalTableIntoLegerJournalTmp</Name>
				<Source><![CDATA[
    private void mapLedgerJournalTableIntoLegerJournalTmp(QueryBuildDataSource _ledgerJournalTableDataSource, Map _insertMap)
    {
        int ledgerJournalTableDataSourceUniqueId = _ledgerJournalTableDataSource.uniqueId();

        this.addLedgerJournalTableFields(_ledgerJournalTableDataSource);
 
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, LedgerJournalType),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, JournalType)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, JournalNum),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, JournalNum)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, JournalName),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, JournalName)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, Name),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, Name)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, ReportedAsReadyBy),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, ReportedAsReadyBy)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, RejectedBy),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, RejectedBy)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, Posted),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, Posted)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, PostedDateTime),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, PostedDateTime)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, Log),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, Log)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, Approver),
            [ledgerJournalTableDataSourceUniqueId, fieldStr(LedgerJournalTable, Approver)]);
    }

]]></Source>
			</Method>
			<Method>
				<Name>addLedgerJournalTableFields</Name>
				<Source><![CDATA[
    private void addLedgerJournalTableFields(QueryBuildDataSource _ledgerJournalTableDataSource)
    {
        QueryBuildFieldList ledgerJournalTableFields = _ledgerJournalTableDataSource.fields();

        ledgerJournalTableFields.addField(fieldNum(LedgerJournalTable, JournalType));
        ledgerJournalTableFields.addField(fieldNum(LedgerJournalTable, JournalNum));
        ledgerJournalTableFields.addField(fieldNum(LedgerJournalTable, JournalName));
        ledgerJournalTableFields.addField(fieldNum(LedgerJournalTable, Name));
        ledgerJournalTableFields.addField(fieldNum(LedgerJournalTable, ReportedAsReadyBy));
        ledgerJournalTableFields.addField(fieldNum(LedgerJournalTable, RejectedBy));
        ledgerJournalTableFields.addField(fieldNum(LedgerJournalTable, Posted));
        ledgerJournalTableFields.addField(fieldNum(LedgerJournalTable, PostedDateTime));
        ledgerJournalTableFields.addField(fieldNum(LedgerJournalTable, Log));
        ledgerJournalTableFields.addField(fieldNum(LedgerJournalTable, Approver));
    }

]]></Source>
			</Method>
			<Method>
				<Name>mapLedgerJournalTransIntoLegerJournalTmp</Name>
				<Source><![CDATA[
    private void mapLedgerJournalTransIntoLegerJournalTmp(QueryBuildDataSource _ledgerJournalTransDataSource, Map _insertMap)
    {
        int ledgerJournalTransDataSourceUniqueId = _ledgerJournalTransDataSource.uniqueId();

        this.addLedgerJournalTransFields(_ledgerJournalTransDataSource);

        _insertMap.insert(
            fieldStr(LedgerJournalTmp, LedgerDimension),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, LedgerDimension)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, Company),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, Company)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, AccountType),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, AccountType)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, OffsetLedgerDimension),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, OffsetLedgerDimension)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, OffsetCompany),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, OffsetCompany)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, OffsetAccountType),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, OffsetAccountType)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, CurrencyCode),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, CurrencyCode)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, Voucher),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, Voucher)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, Invoice),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, Invoice)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, TransDate),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, TransDate)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, LastTransferred),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, LastTransferred)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, FreqCode),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, FreqCode)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, FreqValue),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, FreqValue)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, Due),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, Due)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, DateCashDisc),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, DateCashDisc)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, PaymId),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, PaymId)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, Approved),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, Approved)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, PaymSpec),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, PaymSpec)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, PaymMode),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, PaymMode)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, BankTransType),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, BankTransType)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, PaymReference),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, PaymReference)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, BankDepositNum),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, BankDepositNum)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, BankDepositVoucher),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, BankDepositVoucher)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, Txt),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, Txt)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, OffsetText),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, OffsetTxt)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, TotalAmountSumCredit),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, AmountCurCredit)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, TotalAmountSumDebit),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, AmountCurDebit)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, RemittanceAddressRecID),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, RemittanceAddress)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, LedgerJournalTransRecId),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, RecId)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, DefaultDimension),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, DefaultDimension)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, OffsetDefaultDimension),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, OffsetDefaultDimension)]);
        _insertMap.insert(
            fieldStr(LedgerJournalTmp, PostingProfile),
            [ledgerJournalTransDataSourceUniqueId, fieldStr(LedgerJournalTrans, PostingProfile)]);
    }

]]></Source>
			</Method>
			<Method>
				<Name>addLedgerJournalTransFields</Name>
				<Source><![CDATA[
    private void addLedgerJournalTransFields(QueryBuildDataSource _ledgerJournalTransDataSource)
    {
        QueryBuildFieldList ledgerJournalTransFields = _ledgerJournalTransDataSource.fields();

        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, LedgerDimension));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, OffsetLedgerDimension));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, OffsetCompany));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, Company));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, AccountType));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, OffsetAccountType));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, CurrencyCode));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, Voucher));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, Invoice));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, TransDate));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, LastTransferred));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, FreqCode));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, FreqValue));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, Due));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, DateCashDisc));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, PaymId));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, Approved));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, PaymSpec));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, PaymMode));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, BankTransType));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, PaymReference));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, BankDepositNum));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, BankDepositVoucher));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, Txt));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, OffsetTxt));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, AmountCurCredit));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, AmountCurDebit));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, RemittanceAddress));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, RecId));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, DefaultDimension));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, OffsetDefaultDimension));
        ledgerJournalTransFields.addField(fieldNum(LedgerJournalTrans, PostingProfile));
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateTheRestOfFields</Name>
				<Source><![CDATA[
    private void updateTheRestOfFields()
    {
        update_recordset ledgerJournalTmp
            setting CashDiscAmount = cashDiscAmount,
                IsAccrualRecord = NoYes::No,
                AccountOffsetAccount = AccountOffsetAccount::Account,
                LedgerAccountLedgerDimension = ledgerJournalTmp.LedgerDimension,
                ReportCaption = ledgerJournalReportCaptionsTmp.ReportCaption
        join ledgerJournalReportCaptionsTmp
            where ledgerJournalReportCaptionsTmp.JournalType == ledgerJournalTableTmp.JournalType;
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertOffsetTransactions</Name>
				<Source><![CDATA[
    protected void insertOffsetTransactions()
    {
        this.insertOffsetTransactionsNoOffsetText();
        this.insertOffsetTransactionsOffsetText();
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertOffsetTransactionsNoOffsetText</Name>
				<Source><![CDATA[
    private void insertOffsetTransactionsNoOffsetText()
    {
        SysDaInsertObject insertLedgerJournalTmpObject = this.buildLedgerJournalTmpInsertObject();

        SysDaQueryObject ledgerJournalTmpSourceQuery = this.buildLedgerJournalTmpSourceQuery(fieldStr(LedgerJournalTmp, Txt));
        LedgerJournalTmp ledgerJournalTmpSource = ledgerJournalTmpSourceQuery.table();
        
        ledgerJournalTmpSourceQuery.WhereClause(this.OffsetLedgerDimensionIsNotZero(ledgerJournalTmpSource)
            .and(this.OffsetTextIsEmpty(ledgerJournalTmpSource)));

        this.executeInsertStatement(insertLedgerJournalTmpObject, ledgerJournalTmpSourceQuery);
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertOffsetTransactionsOffsetText</Name>
				<Source><![CDATA[
    // When the OffsetTxt is provided on the Offset side of the journal line, it should be used instead the default Txt.
    private void insertOffsetTransactionsOffsetText()
    {
        SysDaInsertObject insertLedgerJournalTmpObject = this.buildLedgerJournalTmpInsertObject();

        SysDaQueryObject ledgerJournalTmpSourceQuery = this.buildLedgerJournalTmpSourceQuery(fieldStr(LedgerJournalTmp, OffsetText));
        LedgerJournalTmp ledgerJournalTmpSource = ledgerJournalTmpSourceQuery.table();
        
        ledgerJournalTmpSourceQuery.WhereClause(this.OffsetLedgerDimensionIsNotZero(ledgerJournalTmpSource)
            .and(this.OffsetTextIsNotEmpty(ledgerJournalTmpSource)));

        this.executeInsertStatement(insertLedgerJournalTmpObject, ledgerJournalTmpSourceQuery);
    }

]]></Source>
			</Method>
			<Method>
				<Name>buildLedgerJournalTmpInsertObject</Name>
				<Source><![CDATA[
    private SysDaInsertObject buildLedgerJournalTmpInsertObject()
    {
        LedgerJournalTmp ledgerJournalTmpDist;
        this.takeOwnershipOfTempTable(ledgerJournalTmpDist);
        ledgerJournalTmpDist.linkPhysicalTableInstance(ledgerJournalTmp);

        SysDaInsertObject insertLedgerJournalTmpObject = new SysDaInsertObject(ledgerJournalTmpDist);

        this.addFieldsInsertLedgerJournalTmp(insertLedgerJournalTmpObject);

        return insertLedgerJournalTmpObject;
    }

]]></Source>
			</Method>
			<Method>
				<Name>addFieldsInsertLedgerJournalTmp</Name>
				<Source><![CDATA[
    private void addFieldsInsertLedgerJournalTmp(SysDaInsertObject _insertLedgerJournalTmpObject)
    {
        _insertLedgerJournalTmpObject.fields()
            .add(fieldStr(LedgerJournalTmp, LedgerJournalType))
            .add(fieldStr(LedgerJournalTmp, JournalNum))
            .add(fieldStr(LedgerJournalTmp, JournalName))
            .add(fieldStr(LedgerJournalTmp, Name))
            .add(fieldStr(LedgerJournalTmp, ReportedAsReadyBy))
            .add(fieldStr(LedgerJournalTmp, RejectedBy))
            .add(fieldStr(LedgerJournalTmp, Posted))
            .add(fieldStr(LedgerJournalTmp, PostedDateTime))
            .add(fieldStr(LedgerJournalTmp, Log))
            .add(fieldStr(LedgerJournalTmp, Approver))
            .add(fieldStr(LedgerJournalTmp, ReportCaption))
            .add(fieldStr(LedgerJournalTmp, LedgerDimension))
            .add(fieldStr(LedgerJournalTmp, LedgerAccountLedgerDimension))
            .add(fieldStr(LedgerJournalTmp, Company))
            .add(fieldStr(LedgerJournalTmp, AccountType))
            .add(fieldStr(LedgerJournalTmp, CurrencyCode))
            .add(fieldStr(LedgerJournalTmp, Voucher))
            .add(fieldStr(LedgerJournalTmp, Invoice))
            .add(fieldStr(LedgerJournalTmp, TransDate))
            .add(fieldStr(LedgerJournalTmp, LastTransferred))
            .add(fieldStr(LedgerJournalTmp, FreqCode))
            .add(fieldStr(LedgerJournalTmp, FreqValue))
            .add(fieldStr(LedgerJournalTmp, Due))
            .add(fieldStr(LedgerJournalTmp, CashDiscAmount))
            .add(fieldStr(LedgerJournalTmp, DateCashDisc))
            .add(fieldStr(LedgerJournalTmp, PaymId))
            .add(fieldStr(LedgerJournalTmp, Approved))
            .add(fieldStr(LedgerJournalTmp, PaymSpec))
            .add(fieldStr(LedgerJournalTmp, PaymMode))
            .add(fieldStr(LedgerJournalTmp, BankTransType))
            .add(fieldStr(LedgerJournalTmp, PaymReference))
            .add(fieldStr(LedgerJournalTmp, BankDepositNum))
            .add(fieldStr(LedgerJournalTmp, BankDepositVoucher))
            .add(fieldStr(LedgerJournalTmp, Txt))
            .add(fieldStr(LedgerJournalTmp, TotalAmountSumCredit))
            .add(fieldStr(LedgerJournalTmp, TotalAmountSumDebit))
            .add(fieldStr(LedgerJournalTmp, RemittanceAddressRecID))
            .add(fieldStr(LedgerJournalTmp, LedgerJournalTransRecId))
            .add(fieldStr(LedgerJournalTmp, IsAccrualRecord))
            .add(fieldStr(LedgerJournalTmp, AccountOffsetaccount))
            .add(fieldStr(LedgerJournalTmp, OffsetDefaultDimension))
            .add(fieldStr(LedgerJournalTmp, PostingProfile));
    }

]]></Source>
			</Method>
			<Method>
				<Name>buildLedgerJournalTmpSourceQuery</Name>
				<Source><![CDATA[
    private SysDaQueryObject buildLedgerJournalTmpSourceQuery(str _fieldTxt)
    {
        LedgerJournalTmp ledgerJournalTmpSource;
        this.takeOwnershipOfTempTable(ledgerJournalTmpSource);
        ledgerJournalTmpSource.linkPhysicalTableInstance(ledgerJournalTmp);

        SysDaQueryObject ledgerJournalTmpSourceQuery = new SysDaQueryObject(ledgerJournalTmpSource);

        ledgerJournalTmpSourceQuery.projection()
            .Add(fieldStr(LedgerJournalTmp, LedgerJournalType))
            .Add(fieldStr(LedgerJournalTmp, JournalNum))
            .Add(fieldStr(LedgerJournalTmp, JournalName))
            .Add(fieldStr(LedgerJournalTmp, Name))
            .Add(fieldStr(LedgerJournalTmp, ReportedAsReadyBy))
            .Add(fieldStr(LedgerJournalTmp, RejectedBy))
            .Add(fieldStr(LedgerJournalTmp, Posted))
            .Add(fieldStr(LedgerJournalTmp, PostedDateTime))
            .Add(fieldStr(LedgerJournalTmp, Log))
            .Add(fieldStr(LedgerJournalTmp, Approver))
            .Add(fieldStr(LedgerJournalTmp, ReportCaption))
            .Add(fieldStr(LedgerJournalTmp, OffsetLedgerDimension))
            .Add(fieldStr(LedgerJournalTmp, OffsetLedgerDimension)) // default value for LedgerAccountLedgerDimension
            .Add(fieldStr(LedgerJournalTmp, OffsetCompany))
            .Add(fieldStr(LedgerJournalTmp, OffsetAccountType))
            .Add(fieldStr(LedgerJournalTmp, CurrencyCode))
            .Add(fieldStr(LedgerJournalTmp, Voucher))
            .Add(fieldStr(LedgerJournalTmp, Invoice))
            .Add(fieldStr(LedgerJournalTmp, TransDate))
            .Add(fieldStr(LedgerJournalTmp, LastTransferred))
            .Add(fieldStr(LedgerJournalTmp, FreqCode))
            .Add(fieldStr(LedgerJournalTmp, FreqValue))
            .Add(fieldStr(LedgerJournalTmp, Due))
            .AddValue(0) // CashDiscAmount is zero on the offset
            .Add(fieldStr(LedgerJournalTmp, DateCashDisc))
            .Add(fieldStr(LedgerJournalTmp, PaymId))
            .Add(fieldStr(LedgerJournalTmp, Approved))
            .Add(fieldStr(LedgerJournalTmp, PaymSpec))
            .Add(fieldStr(LedgerJournalTmp, PaymMode))
            .Add(fieldStr(LedgerJournalTmp, BankTransType))
            .Add(fieldStr(LedgerJournalTmp, PaymReference))
            .Add(fieldStr(LedgerJournalTmp, BankDepositNum))
            .Add(fieldStr(LedgerJournalTmp, BankDepositVoucher))
            .Add(_fieldTxt)
            .Add(fieldStr(LedgerJournalTmp, TotalAmountSumDebit))
            .Add(fieldStr(LedgerJournalTmp, TotalAmountSumCredit))
            .Add(fieldStr(LedgerJournalTmp, RemittanceAddressRecID))
            .Add(fieldStr(LedgerJournalTmp, LedgerJournalTransRecId))
            .Add(fieldStr(LedgerJournalTmp, IsAccrualRecord))
            .AddValue(AccountOffsetaccount::OffsetAccount)
            .Add(fieldStr(ledgerjournaltmp, OffsetDefaultDimension))
            .Add(fieldStr(ledgerjournaltmp, PostingProfile));

        return ledgerJournalTmpSourceQuery;
    }

]]></Source>
			</Method>
			<Method>
				<Name>OffsetLedgerDimensionIsNotZero</Name>
				<Source><![CDATA[
    private SysDaNotEqualsExpression OffsetLedgerDimensionIsNotZero(LedgerJournalTmp _ledgerJournalTmpSource)
    {
        return new SysDaNotEqualsExpression(
            new SysDaFieldExpression(_ledgerJournalTmpSource, fieldStr(LedgerJournalTmp, OffsetLedgerDimension)),
            new SysDaValueExpression(0));
    }

]]></Source>
			</Method>
			<Method>
				<Name>OffsetTextIsEmpty</Name>
				<Source><![CDATA[
    private SysDaEqualsExpression OffsetTextIsEmpty(LedgerJournalTmp _ledgerJournalTmpSource)
    {
        return new SysDaEqualsExpression(
                    new SysDaFieldExpression(_ledgerJournalTmpSource, fieldStr(LedgerJournalTmp, OffsetText)),
                    new SysDaValueExpression(''));
    }

]]></Source>
			</Method>
			<Method>
				<Name>OffsetTextIsNotEmpty</Name>
				<Source><![CDATA[
    private SysDaNotEqualsExpression OffsetTextIsNotEmpty(LedgerJournalTmp _ledgerJournalTmpSource)
    {
        return new SysDaNotEqualsExpression(
                    new SysDaFieldExpression(_ledgerJournalTmpSource, fieldStr(LedgerJournalTmp, OffsetText)),
                    new SysDaValueExpression(''));
    }

]]></Source>
			</Method>
			<Method>
				<Name>executeInsertStatement</Name>
				<Source><![CDATA[
    private void executeInsertStatement(SysDaInsertObject _insertObject, SysDaQueryObject _query)
    {
        _insertObject.query(_query);

        SysDaInsertStatement insertStmt = new SysDaInsertStatement();
        insertStmt.executeQuery(_insertObject);
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateReportCaptionsOnLedgerJournalTableTmp</Name>
				<Source><![CDATA[
    private void updateReportCaptionsOnLedgerJournalTableTmp()
    {
        LedgerJournalReportCaptionsTmp reportCaptions;
        this.takeOwnershipOfTempTable(reportCaptions);
        reportCaptions.linkPhysicalTableInstance(ledgerJournalReportCaptionsTmp);

        update_recordset ledgerJournalTableTmp
            setting ReportCaption = reportCaptions.ReportCaption
        join reportCaptions
            where reportCaptions.JournalType == ledgerJournalTableTmp.JournalType;
    }

]]></Source>
			</Method>
			<Method>
				<Name>populateLedgerJournalReportCaptionsTmp</Name>
				<Source><![CDATA[
    private void populateLedgerJournalReportCaptionsTmp()
    {
        RecordInsertList insertList = new RecordInsertList(tableNum(LedgerJournalReportCaptionsTmp), true, true, true, true, true, ledgerJournalReportCaptionsTmp);

        this.insertReportCaption(insertList, LedgerJournalType::Daily, "@SYS25908");
        this.insertReportCaption(insertList, LedgerJournalType::Periodic, "@SYS24600");
        this.insertReportCaption(insertList, LedgerJournalType::PurchaseLedger, "@SYS870");
        this.insertReportCaption(insertList, LedgerJournalType::Approval, "@SYS3827");
        this.insertReportCaption(insertList, LedgerJournalType::Payment, "@SYS23060");
        this.insertReportCaption(insertList, LedgerJournalType::CustPayment, "@SYS23060");
        this.insertReportCaption(insertList, LedgerJournalType::VendInvoicePool, "@SYS57805");
        this.insertReportCaption(insertList, LedgerJournalType::VendInvoiceRegister, "@SYS29154");
        this.insertReportCaption(insertList, LedgerJournalType::Assets, "@SYS25908");
        this.insertReportCaption(insertList, LedgerJournalType::AssetBudgets, "@SYS67664");
        this.insertReportCaption(insertList, LedgerJournalType::ReportingCurrencyAdjustment, "@GeneralLedger:ReportingCurrencyAdjustmentJournal");

        insertList.insertDatabase();
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertReportCaption</Name>
				<Source><![CDATA[
    private void insertReportCaption(RecordInsertList _insertList, LedgerJournalType _journalType, Str1260 _caption )
    {
        ledgerJournalReportCaptionsTmp.clear();
        ledgerJournalReportCaptionsTmp.JournalType = _journalType;
        ledgerJournalReportCaptionsTmp.ReportCaption = _caption;
        _insertList.add(ledgerJournalReportCaptionsTmp);
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateAccountNum</Name>
				<Source><![CDATA[
    private void updateAccountNum()
    {
        DimensionAttributeValueCombination dimAttrValueCombo;
        MainAccount mainAccount;
        MainAccountTranslation mainAccountTranslation;

        update_recordSet ledgerJournalTmp
            setting AccountNum = dimAttrValueCombo.DisplayValue,
                MainAccountName = mainAccount.Name
        join dimAttrValueCombo
            where dimAttrValueCombo.RecId == ledgerJournalTmp.LedgerAccountLedgerDimension
        join mainAccount
            where mainAccount.RecId == dimAttrValueCombo.MainAccount;

        LanguageId currentLanguage = DimensionCache::currentDimensionValueLanguageId();

        if (currentLanguage != '')
        {
            update_recordSet ledgerJournalTmp
                setting MainAccountName = mainAccountTranslation.Name
            join dimAttrValueCombo
                where dimAttrValueCombo.RecId == ledgerJournalTmp.LedgerAccountLedgerDimension
            join mainAccountTranslation
                where dimAttrValueCombo.MainAccount == mainAccountTranslation.MainAccount
                    && mainAccountTranslation.LanguageId == currentLanguage;
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateForLedgerAccounts</Name>
				<Source><![CDATA[
    private void updateForLedgerAccounts()
    {
        update_recordSet ledgerJournalTmp
            setting AccountName = ledgerJournalTmp.MainAccountName
                where ledgerJournalTmp.AccountType == LedgerJournalACType::Ledger;
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateCustomerAccounts</Name>
				<Source><![CDATA[
    private void updateCustomerAccounts()
    {
        this.updateCustomerAccountCurrentCompany();
        this.updateCustomerAccountsInterCompany();
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateCustomerAccountCurrentCompany</Name>
				<Source><![CDATA[
    private void updateCustomerAccountCurrentCompany()
    {
        CustTable CustTable;
        DirPartyTable dirPartyTable;
        DimensionAttributeLevelValueView dimAttrLevelValueView;

        update_recordset ledgerJournalTmp
            setting AccountName = custTable.AccountNum,
                NonLedgerAccountName = dirPartyTable.Name
            where ledgerJournalTmp.AccountType == LedgerJournalACType::Cust
        join dimAttrLevelValueView
            where dimAttrLevelValueView.ValueCombinationRecId == ledgerJournalTmp.LedgerDimension
        join custTable
            where custTable.RecId == dimAttrLevelValueView.EntityInstance
        join dirPartyTable
            where dirPartyTable.RecId == custTable.Party;
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateCustomerAccountsInterCompany</Name>
				<Source><![CDATA[
    private void updateCustomerAccountsInterCompany()
    {
        CustTable CustTable;
        DirPartyTable dirPartyTable;
        DimensionAttributeLevelValueView dimAttrLevelValueView;

        while select forUpdate crossCompany AccountName, NonLedgerAccountName, Company, AccountNum, DefaultDimension, PostingProfile from ledgerJournalTmp
            where ledgerJournalTmp.AccountType == LedgerJournalACType::Cust
                && ledgerJournalTmp.Company != curExt()
        join RecId from dimAttrLevelValueView
            where dimAttrLevelValueView.ValueCombinationRecId == ledgerJournalTmp.LedgerDimension
        join AccountNum from custTable
            where custTable.RecId == dimAttrLevelValueView.EntityInstance
        join Name from dirPartyTable
            where dirPartyTable.RecId == custTable.Party
        {
            if (ledgerJournalTmp.Company)
            {
                changecompany(ledgerJournalTmp.Company)
                {
                    LedgerDimensionAccount customerLedgerDimension = CustTable::findByCompany(ledgerJournalTmp.Company, custTable.AccountNum).summaryLedgerDimension(ledgerJournalTmp.PostingProfile);
                    LedgerDimensionAccount ledgerDimensionAccount = LedgerDimensionFacade::serviceCreateLedgerDimension(customerLedgerDimension, ledgerJournaltmp.DefaultDimension);
                    ledgerJournalTmp.AccountNum = DimensionAttributeValueCombination::find(ledgerDimensionAccount).DisplayValue;
                    ledgerJournalTmp.AccountName = custTable.AccountNum;
                    ledgerJournalTmp.MainAccountName = MainAccount::findByLedgerDimension(customerLedgerDimension).Name;
                    ledgerJournalTmp.NonLedgerAccountName = dirPartyTable.Name;
                    ledgerJournalTmp.update();
                }
            }
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateVendorAccounts</Name>
				<Source><![CDATA[
    private void updateVendorAccounts()
    {
        this.updateVendorAccountCurrentCompany();
        this.updateVendorAccountsInterCompany();
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateVendorAccountCurrentCompany</Name>
				<Source><![CDATA[
    private void updateVendorAccountCurrentCompany()
    {
        VendTable vendTable;
        DirPartyTable dirPartyTable;
        DimensionAttributeLevelValueView dimAttrLevelValueView;

        update_recordset ledgerJournalTmp
            setting AccountName = vendTable.AccountNum,
                NonLedgerAccountName = dirPartyTable.Name
            where ledgerJournalTmp.AccountType == LedgerJournalACType::Vend
        join dimAttrLevelValueView
            where dimAttrLevelValueView.ValueCombinationRecId == ledgerJournalTmp.LedgerDimension
        join vendTable
            where vendTable.RecId == dimAttrLevelValueView.EntityInstance
        join dirPartyTable
            where dirPartyTable.RecId == vendTable.Party;
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateVendorAccountsInterCompany</Name>
				<Source><![CDATA[
    private void updateVendorAccountsInterCompany()
    {
        VendTable vendTable;
        DirPartyTable dirPartyTable;
        DimensionAttributeLevelValueView dimAttrLevelValueView;

        while select forUpdate crossCompany AccountName, NonLedgerAccountName, Company, AccountNum, DefaultDimension, PostingProfile from ledgerJournalTmp
            where ledgerJournalTmp.AccountType == LedgerJournalACType::Vend
                && ledgerJournalTmp.Company != curExt()
        join RecId from dimAttrLevelValueView
            where dimAttrLevelValueView.ValueCombinationRecId == ledgerJournalTmp.LedgerDimension
        join AccountNum from vendTable
            where vendTable.RecId == dimAttrLevelValueView.EntityInstance
        join Name from dirPartyTable
            where dirPartyTable.RecId == vendTable.Party
        {
            if (ledgerJournalTmp.Company)
            {
                changecompany(ledgerJournalTmp.Company)
                {
                    LedgerDimensionAccount vendorLedgerDimension = VendTable::findByCompany(ledgerJournalTmp.Company, vendTable.AccountNum).summaryLedgerDimension(ledgerJournalTmp.PostingProfile);
                    LedgerDimensionAccount ledgerDimensionAccount = LedgerDimensionFacade::serviceCreateLedgerDimension(vendorLedgerDimension, ledgerJournaltmp.DefaultDimension);
                    ledgerJournalTmp.AccountNum = DimensionAttributeValueCombination::find(ledgerDimensionAccount).DisplayValue;
                    ledgerJournalTmp.AccountName = vendTable.AccountNum;
                    ledgerJournalTmp.MainAccountName = MainAccount::findByLedgerDimension(vendorLedgerDimension).Name;
                    ledgerJournalTmp.NonLedgerAccountName = dirPartyTable.Name;
                    ledgerJournalTmp.update();
                }
            }
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateBankAccounts</Name>
				<Source><![CDATA[
    private void updateBankAccounts()
    {
        this.updateBankAccountCurrentCompany();
        this.updateBankAccountsInterCompany();
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateBankAccountCurrentCompany</Name>
				<Source><![CDATA[
    private void updateBankAccountCurrentCompany()
    {
        BankAccountTable bankAccountTable;
        DirPartyTable dirPartyTable;
        DimensionAttributeLevelValueView dimAttrLevelValueView;

        update_recordset ledgerJournalTmp
            setting AccountName = bankAccountTable.AccountID,
                NonLedgerAccountName = bankAccountTable.Name
            where ledgerJournalTmp.AccountType == LedgerJournalACType::Bank
        join dimAttrLevelValueView
            where dimAttrLevelValueView.ValueCombinationRecId == ledgerJournalTmp.LedgerDimension
        join bankAccountTable
            where bankAccountTable.RecId == dimAttrLevelValueView.EntityInstance;
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateBankAccountsInterCompany</Name>
				<Source><![CDATA[
    private void updateBankAccountsInterCompany()
    {
        BankAccountTable bankAccountTable;
        DirPartyTable dirPartyTable;
        DimensionAttributeLevelValueView dimAttrLevelValueView;
        
        while select forUpdate crossCompany AccountName, NonLedgerAccountName, AccountNum, Company, DefaultDimension from ledgerJournalTmp
            where ledgerJournalTmp.AccountType == LedgerJournalACType::Bank
            && ledgerJournalTmp.Company != curExt()
        join RecId from dimAttrLevelValueView
            where dimAttrLevelValueView.ValueCombinationRecId == ledgerJournalTmp.LedgerDimension
        join Name, AccountId from bankAccountTable
            where bankAccountTable.RecId == dimAttrLevelValueView.EntityInstance
        {
            if (ledgerJournalTmp.Company)
            {
                changecompany(ledgerJournalTmp.Company)
                {
                    LedgerDimensionAccount bankLedgerDimension = BankAccountTable::findByCompany(ledgerJournalTmp.Company, bankAccountTable.AccountID).LedgerDimension;
                    LedgerDimensionAccount ledgerDimensionAccount = LedgerDimensionFacade::serviceCreateLedgerDimension(bankLedgerDimension, ledgerJournaltmp.DefaultDimension);
                    ledgerJournalTmp.AccountNum = DimensionAttributeValueCombination::find(ledgerDimensionAccount).DisplayValue;
                    ledgerJournalTmp.AccountName = bankAccountTable.AccountID;
                    ledgerJournalTmp.MainAccountName = MainAccount::findByLedgerDimension(bankLedgerDimension).Name;
                    ledgerJournalTmp.NonLedgerAccountName = bankAccountTable.Name;
                    ledgerJournalTmp.update();
                }
            }
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateProjectAccounts</Name>
				<Source><![CDATA[
    private void updateProjectAccounts()
    {
        ProjTable projTable;
        DimensionAttributeValueCombination dimAttrValueCombo;

        update_recordSet ledgerJournalTmp
            setting AccountName = dimAttrValueCombo.DisplayValue,
                NonLedgerAccountName = projTable.Name
            where ledgerJournalTmp.AccountType == LedgerJournalACType::Project
        join dimAttrValueCombo
            where dimAttrValueCombo.RecId == ledgerJournalTmp.LedgerDimension
        join projTable
            where projTable.ProjId == dimAttrValueCombo.DisplayValue;
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateFixedAssetsAccounts</Name>
				<Source><![CDATA[
    private void updateFixedAssetsAccounts()
    {
        AssetTable assetTable;
        DimensionAttributeLevelValueView dimAttrLevelValueView;

        update_recordset ledgerJournalTmp
            setting AccountName = assetTable.AssetId,
                NonLedgerAccountName = assetTable.Name
            where ledgerJournalTmp.AccountType == LedgerJournalACType::FixedAssets
        join dimAttrLevelValueView
            where dimAttrLevelValueView.ValueCombinationRecId == ledgerJournalTmp.LedgerDimension
        join assetTable
            where assetTable.RecId == dimAttrLevelValueView.EntityInstance;
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateForLocalization</Name>
				<Source><![CDATA[
    private void updateForLocalization()
    {
        DimensionAttributeLevelValueView dimAttrLevelValueView;

        RAssetTable rAssetTable;
        while select forUpdate crossCompany AccountName, NonLedgerAccountName from ledgerJournalTmp
                where ledgerJournalTmp.AccountType == LedgerJournalACType::FixedAssets_RU
            join RecId from dimAttrLevelValueView
                where dimAttrLevelValueView.ValueCombinationRecId == ledgerJournalTmp.LedgerDimension
            join Name, AccountNum from rAssetTable
                where rAssetTable.RecId == dimAttrLevelValueView.EntityInstance
        {
            ledgerJournalTmp.AccountName = rAssetTable.AccountNum;
            ledgerJournalTmp.NonLedgerAccountName = rAssetTable.Name;
            ledgerJournalTmp.update();
        }

        //RU employee accounts
        DirPartyTable dirPartyTable;
        HcmWorker hcmWorker;
        EmployeeTable_RU employeeTable_RU;
        HcmEmployment hcmEmployment;
        while select forUpdate crossCompany AccountName, NonLedgerAccountName from ledgerJournalTmp
                where ledgerJournalTmp.AccountType == LedgerJournalACType::Employee_RU
            join RecId from dimAttrLevelValueView
                where dimAttrLevelValueView.ValueCombinationRecId == ledgerJournalTmp.LedgerDimension
            join RecId, EmployeeId from employeeTable_RU
                where employeeTable_RU.RecId == dimAttrLevelValueView.EntityInstance
            join RecId from hcmEmployment
                where employeeTable_RU.HcmEmployment == hcmEmployment.RecId
            join RecId from hcmWorker
                where hcmEmployment.Worker == hcmWorker.RecId
            join Name from dirPartyTable
                where hcmWorker.Person == dirPartyTable.RecId
        {
            ledgerJournalTmp.AccountName = employeeTable_RU.EmployeeId;
            ledgerJournalTmp.NonLedgerAccountName = dirPartyTable.Name;
            ledgerJournalTmp.update();
        }

        //RU deferral accounts
        RDeferralsTable rDeferralsTable;
        while select forUpdate crossCompany AccountName, NonLedgerAccountName from ledgerJournalTmp
                where ledgerJournalTmp.AccountType == LedgerJournalACType::RDeferrals
            join RecId from dimAttrLevelValueView
                where dimAttrLevelValueView.ValueCombinationRecId == ledgerJournalTmp.LedgerDimension
            join Name, DeferralsId from rDeferralsTable
                where rDeferralsTable.RecId == dimAttrLevelValueView.EntityInstance
        {
            ledgerJournalTmp.AccountName = rDeferralsTable.DeferralsId;
            ledgerJournalTmp.NonLedgerAccountName = rDeferralsTable.Name;
            ledgerJournalTmp.update();
        }

        //RU cash accounts
        RCashTable rCashTable;
        while select forUpdate crossCompany AccountName, NonLedgerAccountName from ledgerJournalTmp
                where ledgerJournalTmp.AccountType == LedgerJournalACType::RCash
            join RecId from dimAttrLevelValueView
                where dimAttrLevelValueView.RecId == ledgerJournalTmp.LedgerDimension
            join Name, AccountNum from rCashTable
                where rCashTable.RecId == dimAttrLevelValueView.EntityInstance
        {
            ledgerJournalTmp.AccountName = rCashTable.AccountNum;
            ledgerJournalTmp.NonLedgerAccountName = rCashTable.Name;
            ledgerJournalTmp.update();
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateApprover</Name>
				<Source><![CDATA[
    private void updateApprover()
    {
        HcmWorker hcmWorker;

        update_recordSet ledgerJournalTmp
            setting LedgerJournalTransApprovedBy = hcmWorker.PersonnelNumber
        join hcmWorker
            where ledgerJournalTmp.Approver == hcmWorker.RecId;
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateRemittanceAddress</Name>
				<Source><![CDATA[
    private void updateRemittanceAddress()
    {
        LogisticsPostalAddress logisticsAddress;

        update_recordSet ledgerJournalTmp
            setting RemittanceAddress = logisticsAddress.Address
        join logisticsAddress
            where ledgerJournalTmp.RemittanceAddressRecID == logisticsAddress.RecId;
    }

]]></Source>
			</Method>
			<Method>
				<Name>createLedgerJournalTableTmp</Name>
				<Source><![CDATA[
    private LedgerJournalTableTmp createLedgerJournalTableTmp(LedgerJournalTable _ledgerJournalTable)
    {
        ledgerJournalTableTmp.clear();
        ledgerJournalTableTmp.initFromLedgerJournalTable(_ledgerJournalTable);
        ledgerJournalTableTmp.ReportCaption = this.setReportName(_ledgerJournalTable.JournalType);

        return ledgerJournalTableTmp;
    }

]]></Source>
			</Method>
			<Method>
				<Name>setReportName</Name>
				<Source><![CDATA[
    /// <summary>
    /// Finds a report title based on the <c>LedgerJournalType</c> enumeration value.
    /// </summary>
    /// <param name="_ledgerJournalType">
    /// A <c>LedgerJournalType</c> enumeration value.
    /// </param>
    /// <returns>
    /// The report title.
    /// </returns>
    private Caption setReportName(LedgerJournalType _ledgerJournalType)
    {
        Caption reportCaption;

        switch (_ledgerJournalType)
        {
            case LedgerJournalType::Daily :
                reportCaption = "@SYS25908";
                break;
            case LedgerJournalType::Periodic :
                reportCaption ="@SYS24600";
                break;
            case LedgerJournalType::PurchaseLedger :
                reportCaption = "@SYS870";
                break;
            case LedgerJournalType::Approval :
                reportCaption = "@SYS3827";
                break;
            case LedgerJournalType::Payment :
                reportCaption = "@SYS23060";
                break;
            case LedgerJournalType::CustPayment :
                reportCaption = "@SYS23060";
                break;
            case LedgerJournalType::VendInvoicePool :
                reportCaption = "@SYS57805";
                break;
            case LedgerJournalType::VendInvoiceRegister :
                reportCaption = "@SYS29154";
                break;
            case LedgerJournalType::Assets :
                reportCaption = "@SYS25908";
                break;
            case LedgerJournalType::AssetBudgets :
                reportCaption = "@SYS67664";
                break;
            case LedgerJournalType::ReportingCurrencyAdjustment :
                reportCaption = "@GeneralLedger:ReportingCurrencyAdjustmentJournal";
                break;
            default :
                reportCaption = "@SYS6790";
                break;
        }

        return reportCaption;
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateLedgerDimensionForAccrualTrans</Name>
				<Source><![CDATA[
    private void updateLedgerDimensionForAccrualTrans()
    {
        LedgerJournalTrans          ledgerJournalTrans;
        LedgerJournalTransAccrual   ledgerJournalTransAccrual;

        while select forUpdate LedgerAccountLedgerDimension from ledgerJournalTmp
        join RecId from ledgerJournalTrans
            where ledgerJournalTrans.RecId == ledgerJournalTmp.LedgerJournalTransRecId
        join RefTableid, RefRecid, AccountOffsetaccount, AmountCur, AccrualId from ledgerJournalTransAccrual
            where ledgerJournalTransAccrual.RefTableid == tablenum(LedgerJournalTrans)
                && ledgerJournalTransAccrual.RefRecid == ledgerJournalTrans.RecId
                && ledgerJournalTransAccrual.AccountOffsetaccount == ledgerJournalTmp.AccountOffsetaccount
                && ledgerJournalTmp.AccountOffsetaccount == AccountOffsetaccount::Account
        {
            if (ledgerJournalTmp != null)
            {
                ledgerJournalTmp.LedgerAccountLedgerDimension = LedgerAccrualTrans::construct(ledgerJournalTransAccrual).getOffsetLedgerDimension(ledgerJournalTransAccrual.AmountCur);

                if (ledgerJournalTmp.LedgerAccountLedgerDimension)
                {
                    ledgerJournalTmp.update();
                }
            }
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertJournalTransForLedgerJournalTable</Name>
				<Source><![CDATA[
    [SysObsolete('This method will be deprecated in a future release.  Use insertTransactionsFromLedgerJournalTrans() and insertOffsetTransactions() instead.', false, 30\06\2020)]
    protected void insertJournalTransForLedgerJournalTable(LedgerJournalTable _ledgerJournalTable)
    {
        LedgerJournalTrans      ledgerJournalTrans;
        LedgerJournalTable      ledgerJournalTable;
        NoYes isAccrualRecord = NoYes::No;
        Str1260 reportCaption = this.setReportName(_ledgerJournalTable.JournalType);
        AccountOffsetaccount acctOffsetAccount = AccountOffsetaccount::Account;

        insert_recordset ledgerJournalTmp
        (
            LedgerJournalType,
            JournalNum,
            JournalName,
            Name,
            ReportedAsReadyBy,
            RejectedBy,
            Posted,
            PostedDateTime,
            Log,
            Approver,
            ReportCaption,
            LedgerDimension,
            LedgerAccountLedgerDimension,
            Company,
            AccountType,
            CurrencyCode,
            Voucher,
            Invoice,
            TransDate,
            LastTransferred,
            FreqCode,
            FreqValue,
            Due,
            CashDiscAmount,
            DateCashDisc,
            PaymId,
            Approved,
            PaymSpec,
            PaymMode,
            BankTransType,
            PaymReference,
            BankDepositNum,
            BankDepositVoucher,
            Txt,
            TotalAmountSumCredit,
            TotalAmountSumDebit,
            RemittanceAddressRecID,
            LedgerJournalTransRecId,
            IsAccrualRecord,
            DefaultDimension,
            PostingProfile,
            AccountOffsetaccount
        )
        select
            JournalType,
            JournalNum,
            JournalName,
            Name,
            ReportedAsReadyBy,
            RejectedBy,
            Posted,
            PostedDateTime,
            Log,
            Approver,
            reportCaption
        from ledgerJournalTable
           where ledgerJournalTable.RecId == _ledgerJournalTable.RecId
        join
            LedgerDimension,
            LedgerDimension, // default value for LedgerAccountLedgerDimension
            Company,
            AccountType,
            CurrencyCode,
            Voucher,
            Invoice,
            TransDate,
            LastTransferred,
            FreqCode,
            FreqValue,
            Due,
            CashDiscAmount,
            DateCashDisc,
            PaymId,
            Approved,
            PaymSpec,
            PaymMode,
            BankTransType,
            PaymReference,
            BankDepositNum,
            BankDepositVoucher,
            Txt,
            AmountCurCredit,
            AmountCurDebit,
            RemittanceAddress,
            RecId,
            isAccrualRecord,
            DefaultDimension,
            PostingProfile,
            acctOffsetAccount
        from ledgerJournalTrans
            where ledgerJournalTrans.JournalNum == ledgerJournalTable.JournalNum;

        acctOffsetAccount = AccountOffsetaccount::OffsetAccount;
        insert_recordset ledgerJournalTmp
        (
            LedgerJournalType,
            JournalNum,
            JournalName,
            Name,
            ReportedAsReadyBy,
            RejectedBy,
            Posted,
            PostedDateTime,
            Log,
            Approver,
            ReportCaption,
            LedgerDimension,
            LedgerAccountLedgerDimension,
            Company,
            AccountType,
            CurrencyCode,
            Voucher,
            Invoice,
            TransDate,
            LastTransferred,
            FreqCode,
            FreqValue,
            Due,
            // CashDiscAmount is zero on the offset
            DateCashDisc,
            PaymId,
            Approved,
            PaymSpec,
            PaymMode,
            BankTransType,
            PaymReference,
            BankDepositNum,
            BankDepositVoucher,
            Txt,
            OffsetText,
            TotalAmountSumCredit,
            TotalAmountSumDebit,
            RemittanceAddressRecID,
            LedgerJournalTransRecId,
            IsAccrualRecord,
            DefaultDimension,
            PostingProfile,
            AccountOffsetaccount
        )
        select
            JournalType,
            JournalNum,
            JournalName,
            Name,
            ReportedAsReadyBy,
            RejectedBy,
            Posted,
            PostedDateTime,
            Log,
            Approver,
            reportCaption
        from ledgerJournalTable
            where ledgerJournalTable.RecId == _ledgerJournalTable.RecId
        join
            OffsetLedgerDimension,
            OffsetLedgerDimension, // default value for LedgerAccountLedgerDimension
            OffsetCompany,
            OffsetAccountType,
            CurrencyCode,
            Voucher,
            Invoice,
            TransDate,
            LastTransferred,
            FreqCode,
            FreqValue,
            Due,
            // CashDiscAmount is zero on the offset
            DateCashDisc,
            PaymId,
            Approved,
            PaymSpec,
            PaymMode,
            BankTransType,
            PaymReference,
            BankDepositNum,
            BankDepositVoucher,
            Txt,
            OffsetTxt,
            AmountCurDebit, // Reversed Debit and Credit here since we are viewing the Offset side of the line
            AmountCurCredit,
            RemittanceAddress,
            RecId,
            isAccrualRecord,
            OffsetDefaultDimension,
            PostingProfile,
            acctOffsetAccount
        from ledgerJournalTrans
            where ledgerJournalTrans.JournalNum == ledgerJournalTable.JournalNum
                && ledgerJournalTrans.OffsetLedgerDimension != 0;

        // When the OffsetTxt is provided on the Offset side of the journal line, it should be used instead the default Txt.
        update_recordSet ledgerJournalTmp
            setting Txt = ledgerJournalTmp.OffsetText
                where LedgerJournalTmp.AccountOffsetaccount == AccountOffsetaccount::OffsetAccount
                    && ledgerJournalTmp.OffsetText != '';
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertInfoFromLedgerJournalTrans</Name>
				<Source><![CDATA[
    private void insertInfoFromLedgerJournalTrans()
    {
        this.insertTransactionsFromLedgerJournalTrans();
        this.insertOffsetTransactions();
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertTransactionsFromLedgerJournalTrans</Name>
				<Source><![CDATA[
    protected void insertTransactionsFromLedgerJournalTrans()
    {
        LedgerJournalTrans      ledgerJournalTrans;
        NoYes isAccrualRecord = NoYes::No;
        AccountOffsetaccount acctOffsetAccount = AccountOffsetaccount::Account;

        insert_recordset ledgerJournalTmp
        (
            LedgerJournalType,
            JournalNum,
            JournalName,
            Name,
            ReportedAsReadyBy,
            RejectedBy,
            Posted,
            PostedDateTime,
            Log,
            Approver,
            ReportCaption,
            LedgerDimension,
            LedgerAccountLedgerDimension,
            Company,
            AccountType,
            CurrencyCode,
            Voucher,
            Invoice,
            TransDate,
            LastTransferred,
            FreqCode,
            FreqValue,
            Due,
            CashDiscAmount,
            DateCashDisc,
            PaymId,
            Approved,
            PaymSpec,
            PaymMode,
            BankTransType,
            PaymReference,
            BankDepositNum,
            BankDepositVoucher,
            Txt,
            OffsetText,
            TotalAmountSumCredit,
            TotalAmountSumDebit,
            RemittanceAddressRecID,
            LedgerJournalTransRecId,
            IsAccrualRecord,
            AccountOffsetaccount,
            OffsetLedgerDimension,
            OffsetAccountType,
            DefaultDimension,
            OffsetDefaultDimension,
            PostingProfile,
            OffsetCompany
        )
        select
            JournalType,
            JournalNum,
            JournalName,
            Name,
            ReportedAsReadyBy,
            RejectedBy,
            Posted,
            PostedDateTime,
            Log,
            Approver,
            ReportCaption
        from ledgerJournalTableTmp
        join
            LedgerDimension,
            LedgerDimension, // default value for LedgerAccountLedgerDimension
            Company,
            AccountType,
            CurrencyCode,
            Voucher,
            Invoice,
            TransDate,
            LastTransferred,
            FreqCode,
            FreqValue,
            Due,
            CashDiscAmount,
            DateCashDisc,
            PaymId,
            Approved,
            PaymSpec,
            PaymMode,
            BankTransType,
            PaymReference,
            BankDepositNum,
            BankDepositVoucher,
            Txt,
            OffsetTxt,
            AmountCurCredit,
            AmountCurDebit,
            RemittanceAddress,
            RecId,
            isAccrualRecord,
            acctOffsetAccount,
            OffsetLedgerDimension,
            OffsetAccountType,
            DefaultDimension,
            OffsetDefaultDimension,
            PostingProfile,
            OffsetCompany
        from ledgerJournalTrans
            where ledgerJournalTrans.JournalNum == ledgerJournalTableTmp.JournalNum;
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateLedgerDimensionFromPostingProfile</Name>
				<Source><![CDATA[
    // Update LedgerDimension for account type, but when account type is Ledger, calculation is not needed.
    private void updateLedgerDimensionFromPostingProfile()
    {
        LedgerJournalTable ledgerJournalTable;
        LedgerJournalTrans ledgerJournalTrans;

        while select forUpdate
            LedgerAccountLedgerDimension, AccountOffsetaccount from ledgerJournalTmp
        join * from ledgerJournalTrans
            where ledgerJournalTrans.RecId == ledgerJournalTmp.LedgerJournalTransRecId
                && ledgerJournalTmp.AccountType != LedgerJournalACType::Ledger
        join * from ledgerJournalTable
            where ledgerJournalTrans.JournalNum == ledgerJournalTable.JournalNum
        {
            boolean isInterCompany = ledgerJournalTrans.isCompanyIntercompany();

            if (ledgerJournalTmp.AccountOffsetaccount == AccountOffsetaccount::OffsetAccount)
            {
                ledgerJournalTrans.LedgerDimension = ledgerJournalTrans.OffsetLedgerDimension;
                ledgerJournalTrans.AccountType = ledgerJournalTrans.OffsetAccountType;
                ledgerJournalTrans.Company = ledgerJournalTrans.OffsetCompany;

                isInterCompany = ledgerJournalTrans.isCompanyIntercompany();

                Amount tempAmount = ledgerJournalTrans.AmountCurDebit;
                ledgerJournalTrans.AmountCurDebit = ledgerJournalTrans.AmountCurCredit;
                ledgerJournalTrans.AmountCurCredit = tempAmount;

                ledgerJournalTrans.DefaultDimension = isInterCompany ? ledgerJournalTrans.DefaultDimension : ledgerJournalTrans.OffsetDefaultDimension;
            }

            if (isInterCompany && ledgerJournalTmp.AccountOffsetaccount == AccountOffsetaccount::Account)
            {
                ledgerJournalTrans.DefaultDimension = (isInterCompany && ledgerJournalTrans.Company == curext()) ?
                    ledgerJournalTrans.DefaultDimension : ledgerJournalTrans.OffsetDefaultDimension;
            }

            boolean isOffset = ledgerJournalTmp.AccountOffsetaccount == AccountOffsetaccount::OffsetAccount;
            ledgerJournalTmp.LedgerAccountLedgerDimension = ledgerJournalTrans.getLedgerDimensionForJournalAccount(ledgerJournalTable, isOffset);

            ledgerJournalTmp.update();
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>logProcessReport</Name>
				<Source><![CDATA[
    private SysInstrumentationActivityContext logProcessReport(LedgerJournalContract _reportContract, Query _query)
    {
        const str InstrumentationNamespace = 'LedgerJournal';

        SysInstrumentationLogger instrumentationLogger = SysInstrumentationLoggerFactory::CreateLogger(InstrumentationNamespace);

        SysInstrumentationActivity activityContext = this.getActivityContextForReport(
            InstrumentationNamespace,
            _reportContract,
            _query);

        return instrumentationLogger.activityContextWithCustomProperties(activityContext);
    }

]]></Source>
			</Method>
			<Method>
				<Name>getActivityContextForReport</Name>
				<Source><![CDATA[
    private SysInstrumentationActivity getActivityContextForReport(
        str _instrumentationNamespace,
        LedgerJournalContract _reportContract,
        Query _query)
    {
        const str MetricName = methodStr(LedgerJournalDP, processReport);

        SysInstrumentationActivity activityContext = SysInstrumentationActivity::construct(
            MetricName,
            _instrumentationNamespace);

        int rowCount = QueryRun::getQueryRowCount(_query, maxInt());
        activityContext.addCustomProperty('RowCountForReport', int2Str(rowCount));

        activityContext.addCustomProperty(UseOldLedgerJournalDPReportFlight, this.isFlightEnabled ? 'true' : 'false');
        
        if (_reportContract.parmShowAccrualTrans())
        {
            activityContext.addCustomProperty('ShowAccrualTrans', 'true');
        }

        if (_reportContract.parmJournalContext() == false)
        {
            activityContext.addCustomProperty('JournalContext', 'false');
        }

        return activityContext;
    }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>