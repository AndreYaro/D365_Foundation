<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>InventItemPriceCompareDP</Name>
	<SourceCode>
		<Declaration><![CDATA[
/// <summary>
/// The <c>InventItemPriceCompareDP</c> class provides data for the <c>InventItemPriceCompare</c> SSRS report.
/// </summary>
[
    SRSReportQueryAttribute(queryStr(InventItemPriceCompare)),
    SRSReportParameterAttribute(classStr(InventItemPriceCompareContract))
]
class InventItemPriceCompareDP extends SRSReportDataProviderBase
{
    InventItemPriceCompareContract      contract;
    CostingVersion                      costingVersion;
    CostingVersion                      compareToCostingVersion;
    InventItemPriceCompare              inventItemPriceCompare, inventItemPriceCompareTo;
    InventItemPriceCompareResultTmp     inventItemPriceCompareResult;
    InventCostLevel                     detailCostLevel;

    private static boolean isInventItemPriceComparePerformanceFlightEnabled = InventItemPriceComparePerformanceFlight::instance().isEnabled();

}
]]></Declaration>
		<Methods>
			<Method>
				<Name>compareRollup</Name>
				<Source><![CDATA[
    /// <summary>
    /// Determines if the data provider should compare the rollup.
    /// </summary>
    /// <returns>
    /// true if the data provider should compare the rollup; otherwise, false.
    /// </returns>
    protected boolean compareRollup()
    {
        return costingVersion.CostingType == CostingVersionCostingType::Standard &&
               (compareToCostingVersion.CostingType == CostingVersionCostingType::Standard ||
                contract.parmCompareTo() == CostingVersionCompareTo::Active) &&
               contract.parmComparePriceType() == CostingVersionPriceType::Cost &&
               (contract.parmCompareLevel() == InventItemPriceCompareLevel::CostGroupType ||
                contract.parmCompareLevel() == InventItemPriceCompareLevel::CostGroupId);
    }

]]></Source>
			</Method>
			<Method>
				<Name>compareTotal</Name>
				<Source><![CDATA[
    /// <summary>
    /// Determines if the data provider should compare the total.
    /// </summary>
    /// <returns>
    /// true if the data provider should compare the total; otherwise, false.
    /// </returns>
    protected boolean compareTotal()
    {
        return !this.compareRollup();
    }

]]></Source>
			</Method>
			<Method>
				<Name>contractHasRange</Name>
				<Source><![CDATA[
    /// <summary>
    /// Determines if the contract has a range on a table.
    /// </summary>
    /// <returns>
    /// true if the contract has a range on the table; otherwise, false.
    /// </returns>
    protected boolean contractHasRange()
    {
        return SysQueryRangeUtil::queryHasRange(contract.parmQuery());
    }

]]></Source>
			</Method>
			<Method>
				<Name>getInventItemPriceCompareResultTmp</Name>
				<Source><![CDATA[
    /// <summary>
    /// Retrieves the data from the <c>InventItemPriceCompareResultTmp</c> temporary table.
    /// </summary>
    /// <returns>
    /// An instance of the <c>InventItemPriceCompareResultTmp</c> temporary table.
    /// </returns>
    [SRSReportDataSetAttribute(tableStr(InventItemPriceCompareResultTmp))]
    public InventItemPriceCompareResultTmp getInventItemPriceCompareResultTmp()
    {
        select inventItemPriceCompareResult;
        return inventItemPriceCompareResult;
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertComparePrices</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts the prices to compare into the temporary table inventItemPriceCompare.
    /// </summary>
    private void insertComparePrices()
    {
        InventItemPriceSim      inventItemPriceSim;
        InventDim inventDim;

        if (this.contractHasRange())
        {
            Query query = contract.parmQuery();

            QueryBuildDataSource dataSource = query.dataSourceTable(tableNum(InventItemPriceSim));
            dataSource.addRange(fieldNum(InventItemPriceSim, PriceType)).value(queryValue(contract.parmComparePriceType()));
            dataSource.addRange(fieldNum(InventItemPriceSim, VersionId)).value(queryValue(contract.parmCompareVersionId()));
            dataSource.addRange(fieldNum(InventItemPriceSim, FromDate)).value(queryRange(dateNull(), contract.parmCompareDate()));

            QueryRun queryRun = new QueryRun(query);

            while (queryRun.next())
            {
                inventItemPriceSim = queryRun.get(tableNum(InventItemPriceSim));
                inventItemPriceCompare.ItemId = inventItemPriceSim.ItemId;
                inventItemPriceCompare.InventDimId = inventItemPriceSim.InventDimId;
                inventItemPriceCompare.PriceType = inventItemPriceSim.PriceType;
                inventItemPriceCompare.FromDate = inventItemPriceSim.FromDate;
                if (isInventItemPriceComparePerformanceFlightEnabled)
                {
                    inventDim = InventDim::find(inventItemPriceSim.InventDimId);
                    inventItemPriceCompare.configId = inventDim.configId;
                    inventItemPriceCompare.InventSizeId = inventDim.InventSizeId;
                    inventItemPriceCompare.InventColorId = inventDim.InventColorId;
                    inventItemPriceCompare.InventStyleId = inventDim.InventStyleId;
                    inventItemPriceCompare.InventVersionId = inventDim.InventVersionId;
                    inventItemPriceCompare.InventSiteId = inventDim.InventSiteId;
                }
                inventItemPriceCompare.insert();
            }
        }
        else
        {
            if (isInventItemPriceComparePerformanceFlightEnabled)
            {
                insert_recordset inventItemPriceCompare (ItemId, InventDimId, PriceType, FromDate, configId, InventSizeId, InventColorId, InventStyleId, InventVersionId, InventSiteId)
                    select ItemId, InventDimId, PriceType, maxof(FromDate)
                    from inventItemPriceSim
                    group by ItemId, InventDimId, PriceType
                    where inventItemPriceSim.PriceType == contract.parmComparePriceType()
                       && inventItemPriceSim.VersionId == contract.parmCompareVersionId()
                       && inventItemPriceSim.FromDate <= contract.parmCompareDate()
                    join configId, InventSizeId, InventColorId, InventStyleId, InventVersionId, InventSiteId
                        from inventDim
                        group by configId, InventSizeId, InventColorId, InventStyleId, InventVersionId, InventSiteId
                        where inventDim.inventDimId == inventItemPriceSim.InventDimId;
            }
            else
            {
                insert_recordset inventItemPriceCompare (ItemId, InventDimId, PriceType, FromDate)
                    select ItemId, InventDimId, PriceType, maxof(FromDate)
                        from inventItemPriceSim
                    group by ItemId, InventDimId, PriceType
                    where inventItemPriceSim.PriceType == contract.parmComparePriceType()
                       && inventItemPriceSim.VersionId == contract.parmCompareVersionId()
                       && inventItemPriceSim.FromDate <= contract.parmCompareDate();
            }
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareResultForActivePrices</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts the compare results for active prices into the temporary table <c>inventItemPriceCompareResult</c>.
    /// </summary>
    private void insertCompareResultForActivePrices()
    {
        InventItemPriceSimView          inventItemPriceSim;
        InventItemPriceView             inventItemPrice;
        InventItemPriceCompareItemView  inventItemPriceCompareItemView;

        if (this.compareTotal())
        {
            insert_recordset inventItemPriceCompareResult(
                    ItemId, InventDimId,
                    FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                    #inventDimDevelop
                    ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId,
                    CompareToFromDate, CompareToPrice, CompareToPriceUnit, CompareToMarkup, CompareToPriceQty, CompareToPriceAllocateMarkup, CompareToUnitID, CompareToCostCalculationMethod,
                    ItemName, DefaultOrderType)
                select ItemId, InventDimId
                from inventItemPriceCompare
                    join FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                         ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId
                        from inventItemPriceSim
                            where inventItemPriceSim.VersionId      == contract.parmCompareVersionId()
                               && inventItemPriceSim.ItemId         == inventItemPriceCompare.ItemId
                               && inventItemPriceSim.InventDimId    == inventItemPriceCompare.InventDimId
                               && inventItemPriceSim.PriceType      == inventItemPriceCompare.PriceType
                               && inventItemPriceSim.FromDate       == inventItemPriceCompare.FromDate
                    join inventItemPriceCompareTo
                        where inventItemPriceCompareTo.ItemId       == inventItemPriceCompare.ItemId
                           && inventItemPriceCompareTo.InventDimId  == inventItemPriceCompare.InventDimId
                           && inventItemPriceCompareTo.PriceType    == inventItemPriceCompare.PriceType
                            join ActivationDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod
                                from inventItemPrice
                                    where inventItemPrice.ItemId            == inventItemPriceCompareTo.ItemId
                                       && inventItemPrice.InventDimId       == inventItemPriceCompareTo.InventDimId
                                       && inventItemPrice.PriceType         == inventItemPriceCompareTo.PriceType
                                       && inventItemPrice.ActivationDate    == inventItemPriceCompareTo.FromDate
                                       && inventItemPrice.CreatedDateTime1  == inventItemPriceCompareTo.ActivatedDataTime
                    join Name, DefaultOrderType
                        from inventItemPriceCompareItemView
                            where inventItemPriceCompareItemView.ItemId == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareItemView.ItemDataAreaId == inventItemPriceCompare.DataAreaId;
        }
        if (this.compareRollup())
        {
            this.insertCompareResultForActiveRollup();
            this.insertCompareResultForActiveRollupNX();
            this.insertCompareResultForActiveRollupNXTo();
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareResultForActiveRollup</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts compare result for active rollup where rollup exists for compare and compare to.
    /// </summary>
    private void insertCompareResultForActiveRollup()
    {
        InventItemPriceSimView              inventItemPriceSim;
        InventItemCostGroupRollupSimView    inventItemCostGroupRollupSim;
        InventItemPriceView                 inventItemPrice;
        InventItemCostGroupRollupView       inventItemCostGroupRollup;
        InventItemPriceCompareItemView      inventItemPriceCompareItemView;

        insert_recordset inventItemPriceCompareResult(
                ItemId, InventDimId,
                FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                #inventDimDevelop
                ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId,
                CostGroupId, UnitPrice, CostGroupType, CostLevel,
                CompareToFromDate, CompareToPrice, CompareToPriceUnit, CompareToMarkup, CompareToPriceQty, CompareToPriceAllocateMarkup, CompareToUnitID, CompareToCostCalculationMethod,
                CompareToUnitPrice,
                ItemName, DefaultOrderType)
            select ItemId, InventDimId
                from inventItemPriceCompare
                    join FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                         ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId
                        from inventItemPriceSim
                            where inventItemPriceSim.VersionId      == contract.parmCompareVersionId()
                               && inventItemPriceSim.ItemId         == inventItemPriceCompare.ItemId
                               && inventItemPriceSim.InventDimId    == inventItemPriceCompare.InventDimId
                               && inventItemPriceSim.PriceType      == inventItemPriceCompare.PriceType
                               && inventItemPriceSim.FromDate       == inventItemPriceCompare.FromDate
                    join CostGroupId, UnitPrice, CostGroupType, detailCostLevel
                        from inventItemCostGroupRollupSim
                             where inventItemCostGroupRollupSim.InventItemPriceSimRefRecId == inventItemPriceSim.RecId
                    join inventItemPriceCompareTo
                        where inventItemPriceCompareTo.ItemId       == inventItemPriceCompare.ItemId
                           && inventItemPriceCompareTo.InventDimId  == inventItemPriceCompare.InventDimId
                           && inventItemPriceCompareTo.PriceType    == inventItemPriceCompare.PriceType
                            join ActivationDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod
                                from inventItemPrice
                                    where inventItemPrice.ItemId            == inventItemPriceCompareTo.ItemId
                                       && inventItemPrice.InventDimId       == inventItemPriceCompareTo.InventDimId
                                       && inventItemPrice.PriceType         == inventItemPriceCompareTo.PriceType
                                       && inventItemPrice.ActivationDate    == inventItemPriceCompareTo.FromDate
                                       && inventItemPrice.CreatedDateTime1  == inventItemPriceCompareTo.ActivatedDataTime
                                        join UnitPrice
                                            from inventItemCostGroupRollup
                                                where inventItemCostGroupRollup.InventItemPriceRefRecId == inventItemPrice.RecId
                                                   && inventItemCostGroupRollup.CostGroupId             == inventItemCostGroupRollupSim.CostGroupId
                    join Name, DefaultOrderType
                        from inventItemPriceCompareItemView
                            where inventItemPriceCompareItemView.ItemId == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareItemView.ItemDataAreaId == inventItemPriceCompare.DataAreaId;
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareResultForActiveRollupNX</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts compare result for active rollup where rollup doesn't exists for compare.
    /// </summary>
    private void insertCompareResultForActiveRollupNX()
    {
        InventItemPriceSimView              inventItemPriceSim;
        InventItemCostGroupRollupSimView    inventItemCostGroupRollupSim;
        InventItemPriceView                 inventItemPrice;
        InventItemCostGroupRollupView       inventItemCostGroupRollup;
        InventItemPriceCompareItemView      inventItemPriceCompareItemView;

        insert_recordset inventItemPriceCompareResult(
                ItemId, InventDimId, FromDate, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                #inventDimDevelop
                ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId,
                CompareToFromDate, CompareToPrice, CompareToPriceUnit, CompareToMarkup, CompareToPriceQty, CompareToPriceAllocateMarkup, CompareToUnitID, CompareToCostCalculationMethod,
                CostGroupId, CompareToUnitPrice,
                CostGroupType, CostLevel,
                ItemName, DefaultOrderType)
            select ItemId, InventDimId, FromDate
                from inventItemPriceCompare
                    join PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                         ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId
                        from inventItemPriceSim
                            where inventItemPriceSim.VersionId      == contract.parmCompareVersionId()
                               && inventItemPriceSim.ItemId         == inventItemPriceCompare.ItemId
                               && inventItemPriceSim.InventDimId    == inventItemPriceCompare.InventDimId
                               && inventItemPriceSim.PriceType      == inventItemPriceCompare.PriceType
                               && inventItemPriceSim.FromDate       == inventItemPriceCompare.FromDate
                        join inventItemPriceCompareTo
                            where inventItemPriceCompareTo.ItemId       == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareTo.InventDimId  == inventItemPriceCompare.InventDimId
                               && inventItemPriceCompareTo.PriceType    == inventItemPriceCompare.PriceType
                                join ActivationDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod
                                    from inventItemPrice
                                        where inventItemPrice.ItemId            == inventItemPriceCompareTo.ItemId
                                           && inventItemPrice.InventDimId       == inventItemPriceCompareTo.InventDimId
                                           && inventItemPrice.PriceType         == inventItemPriceCompareTo.PriceType
                                           && inventItemPrice.ActivationDate    == inventItemPriceCompareTo.FromDate
                                           && inventItemPrice.CreatedDateTime1  == inventItemPriceCompareTo.ActivatedDataTime
                                            join CostGroupId, UnitPrice, CostGroupType, detailCostLevel
                                                from inventItemCostGroupRollup
                                                    where inventItemCostGroupRollup.InventItemPriceRefRecId == inventItemPrice.RecId
                    join Name, DefaultOrderType
                        from inventItemPriceCompareItemView
                            where inventItemPriceCompareItemView.ItemId == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareItemView.ItemDataAreaId == inventItemPriceCompare.DataAreaId
                    notexists join inventItemCostGroupRollupSim
                        where inventItemCostGroupRollupSim.InventItemPriceSimRefRecId == inventItemPriceSim.RecId
                           && inventItemCostGroupRollupSim.CostGroupId                == inventItemCostGroupRollup.CostGroupId;
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareResultForActiveRollupNXTo</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts compare result for active rollup where rollup doesn't exists for compare to.
    /// </summary>
    private void insertCompareResultForActiveRollupNXTo()
    {
        InventItemPriceSimView              inventItemPriceSim;
        InventItemCostGroupRollupSimView    inventItemCostGroupRollupSim;
        InventItemPriceView                 inventItemPrice;
        InventItemCostGroupRollupView       inventItemCostGroupRollup;
        InventItemPriceCompareItemView      inventItemPriceCompareItemView;

        insert_recordset inventItemPriceCompareResult(
                ItemId, InventDimId, FromDate,
                Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                #inventDimDevelop
                ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId,
                CostGroupId, UnitPrice, CostGroupType, CostLevel,
                CompareToFromDate, CompareToPriceUnit, CompareToMarkup, CompareToPriceQty, CompareToPriceAllocateMarkup, CompareToUnitID, CompareToCostCalculationMethod,
                ItemName, DefaultOrderType)
            select ItemId, InventDimId, FromDate
                from inventItemPriceCompare
                    join Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                         ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId
                        from inventItemPriceSim
                            where inventItemPriceSim.VersionId      == contract.parmCompareVersionId()
                               && inventItemPriceSim.ItemId         == inventItemPriceCompare.ItemId
                               && inventItemPriceSim.InventDimId    == inventItemPriceCompare.InventDimId
                               && inventItemPriceSim.PriceType      == inventItemPriceCompare.PriceType
                               && inventItemPriceSim.FromDate       == inventItemPriceCompare.FromDate
                                join CostGroupId, UnitPrice, CostGroupType, detailCostLevel
                                    from inventItemCostGroupRollupSim
                                        where inventItemCostGroupRollupSim.InventItemPriceSimRefRecId == inventItemPriceSim.RecId
                    join inventItemPriceCompareTo
                    where inventItemPriceCompareTo.ItemId       == inventItemPriceCompare.ItemId
                       && inventItemPriceCompareTo.InventDimId  == inventItemPriceCompare.InventDimId
                       && inventItemPriceCompareTo.PriceType    == inventItemPriceCompare.PriceType
                        join ActivationDate, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod
                            from inventItemPrice
                                where inventItemPrice.ItemId            == inventItemPriceCompareTo.ItemId
                                   && inventItemPrice.InventDimId       == inventItemPriceCompareTo.InventDimId
                                   && inventItemPrice.PriceType         == inventItemPriceCompareTo.PriceType
                                   && inventItemPrice.ActivationDate    == inventItemPriceCompareTo.FromDate
                                   && inventItemPrice.CreatedDateTime1  == inventItemPriceCompareTo.ActivatedDataTime

                    join Name, DefaultOrderType
                        from inventItemPriceCompareItemView
                            where inventItemPriceCompareItemView.ItemId == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareItemView.ItemDataAreaId == inventItemPriceCompare.DataAreaId
                    notexists join inventItemCostGroupRollup
                        where inventItemCostGroupRollup.InventItemPriceRefRecId == inventItemPrice.RecId
                           && inventItemCostGroupRollup.CostGroupId             == inventItemCostGroupRollupSim.CostGroupId;
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareResultForNonExistingPrices</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts the compare results for non existing prices into the temporary table inventItemPriceCompareResult.
    /// </summary>
    private void insertCompareResultForNonExistingPrices()
    {
        InventItemPriceSimView              inventItemPriceSim;
        InventItemCostGroupRollupSimView    inventItemCostGroupRollupSim;
        InventItemPriceCompareItemView      inventItemPriceCompareItemView;
        PriceUnit                           defaultPriceUnit = 1.0;
        PriceQty                            defaultPriceQty = 1.0;
        PriceAllocateMarkup                 defaultPriceAllocateMarkup = NoYes::Yes;

        if (this.compareTotal())
        {
            insert_recordset inventItemPriceCompareResult(
                    ItemId, InventDimId, FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                    #inventDimDevelop
                    ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId,
                    CompareToPriceUnit, CompareToPriceQty,
                    ItemName, DefaultOrderType)
                select ItemId, InventDimId, FromDate
                    from inventItemPriceCompare
                        join Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                             ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId
                            from inventItemPriceSim
                                where inventItemPriceSim.VersionId      == contract.parmCompareVersionId()
                                   && inventItemPriceSim.ItemId         == inventItemPriceCompare.ItemId
                                   && inventItemPriceSim.InventDimId    == inventItemPriceCompare.InventDimId
                                   && inventItemPriceSim.PriceType      == inventItemPriceCompare.PriceType
                                   && inventItemPriceSim.FromDate       == inventItemPriceCompare.FromDate
                        join defaultPriceUnit, defaultPriceQty, Name, DefaultOrderType
                            from inventItemPriceCompareItemView
                                where inventItemPriceCompareItemView.ItemId == inventItemPriceCompare.ItemId
                                   && inventItemPriceCompareItemView.ItemDataAreaId == inventItemPriceCompare.DataAreaId
                        notexists join inventItemPriceCompareTo
                            where inventItemPriceCompareTo.ItemId       == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareTo.InventDimId  == inventItemPriceCompare.InventDimId
                               && inventItemPriceCompareTo.PriceType    == inventItemPriceCompare.PriceType;
        }
        if (this.compareRollup())
        {
            insert_recordset inventItemPriceCompareResult(
                    ItemId, InventDimId, FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                    #inventDimDevelop
                    ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId,
                    CostGroupId, UnitPrice, CostGroupType, CostLevel,
                    CompareToPriceUnit, CompareToPriceQty,
                    ItemName, DefaultOrderType)
            select ItemId, InventDimId, FromDate
                from inventItemPriceCompare
                    join Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                         ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId
                        from inventItemPriceSim
                            where inventItemPriceSim.VersionId      == contract.parmCompareVersionId()
                               && inventItemPriceSim.ItemId         == inventItemPriceCompare.ItemId
                               && inventItemPriceSim.InventDimId    == inventItemPriceCompare.InventDimId
                               && inventItemPriceSim.PriceType      == inventItemPriceCompare.PriceType
                               && inventItemPriceSim.FromDate       == inventItemPriceCompare.FromDate
                                join CostGroupId, UnitPrice, CostGroupType, detailCostLevel
                                    from inventItemCostGroupRollupSim
                                        where inventItemCostGroupRollupSim.InventItemPriceSimRefRecId == inventItemPriceSim.RecId
                    join defaultPriceUnit, defaultPriceQty, Name, DefaultOrderType
                        from inventItemPriceCompareItemView
                            where inventItemPriceCompareItemView.ItemId == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareItemView.ItemDataAreaId == inventItemPriceCompare.DataAreaId
                    notexists join inventItemPriceCompareTo
                        where inventItemPriceCompareTo.ItemId       == inventItemPriceCompare.ItemId
                           && inventItemPriceCompareTo.InventDimId  == inventItemPriceCompare.InventDimId
                           && inventItemPriceCompareTo.PriceType    == inventItemPriceCompare.PriceType;
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareResultForSimRollup</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts compare result for active rollup where rollup exists for compare and compare to.
    /// </summary>
    private void insertCompareResultForSimRollup()
    {
        InventItemPriceSimView              inventItemPriceSim, inventItemPriceSimTo;
        inventItemCostGroupRollupSimView    inventItemCostGroupRollupSim, inventItemCostGroupRollupSimTo;
        InventItemPriceCompareItemView      inventItemPriceCompareItemView;

        insert_recordset inventItemPriceCompareResult(
                ItemId, InventDimId, FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                #inventDimDevelop
                ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId,
                CostGroupId, UnitPrice, CostGroupType, CostLevel,
                CompareToFromDate, CompareToPrice, CompareToPriceUnit, CompareToMarkup, CompareToPriceQty, CompareToPriceAllocateMarkup, CompareToUnitID, CompareToCostCalculationMethod,
                CompareToUnitPrice,
                ItemName, DefaultOrderType)
            select ItemId, InventDimId, FromDate
                from inventItemPriceCompare
                    join Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                         ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId
                        from inventItemPriceSim
                            where inventItemPriceSim.VersionId      == contract.parmCompareVersionId()
                               && inventItemPriceSim.ItemId         == inventItemPriceCompare.ItemId
                               && inventItemPriceSim.InventDimId    == inventItemPriceCompare.InventDimId
                               && inventItemPriceSim.PriceType      == inventItemPriceCompare.PriceType
                               && inventItemPriceSim.FromDate       == inventItemPriceCompare.FromDate
                               join CostGroupId, UnitPrice, CostGroupType, detailCostLevel
                                    from inventItemCostGroupRollupSim
                                        where inventItemCostGroupRollupSim.InventItemPriceSimRefRecId == inventItemPriceSim.RecId
                    join inventItemPriceCompareTo
                        where inventItemPriceCompareTo.ItemId       == inventItemPriceCompare.ItemId
                           && inventItemPriceCompareTo.InventDimId  == inventItemPriceCompare.InventDimId
                           && inventItemPriceCompareTo.PriceType    == inventItemPriceCompare.PriceType
                            join FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod
                                from inventItemPriceSimTo
                                    where inventItemPriceSimTo.VersionId         == contract.parmCompareToVersionId()
                                       && inventItemPriceSimTo.ItemId            == inventItemPriceCompareTo.ItemId
                                       && inventItemPriceSimTo.InventDimId       == inventItemPriceCompareTo.InventDimId
                                       && inventItemPriceSimTo.PriceType         == inventItemPriceCompareTo.PriceType
                                       && inventItemPriceSimTo.FromDate          == inventItemPriceCompareTo.FromDate
                                        join UnitPrice
                                            from inventItemCostGroupRollupSimTo
                                                where inventItemCostGroupRollupSimTo.InventItemPriceSimRefRecId == inventItemPriceSimTo.RecId
                                                   && inventItemCostGroupRollupSimTo.CostGroupId                == inventItemCostGroupRollupSim.CostGroupId
                    join Name, DefaultOrderType
                        from inventItemPriceCompareItemView
                            where inventItemPriceCompareItemView.ItemId == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareItemView.ItemDataAreaId == inventItemPriceCompare.DataAreaId;
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareResultForSimRollupNX</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts compare result for active rollup where rollup doesn't exists for compare.
    /// </summary>
    private void insertCompareResultForSimRollupNX()
    {
        InventItemPriceSimView              inventItemPriceSim, inventItemPriceSimTo;
        InventItemCostGroupRollupSimView    inventItemCostGroupRollupSim, inventItemCostGroupRollupSimTo;
        InventItemPriceCompareItemView      inventItemPriceCompareItemView;

        insert_recordset inventItemPriceCompareResult(
                ItemId, InventDimId, FromDate, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                #inventDimDevelop
                ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId,
                CompareToFromDate, CompareToPrice, CompareToPriceUnit, CompareToMarkup, CompareToPriceQty, CompareToPriceAllocateMarkup, CompareToUnitID, CompareToCostCalculationMethod,
                CostGroupId, CompareToUnitPrice, CostGroupType, CostLevel,
                ItemName, DefaultOrderType)
            select ItemId, InventDimId, FromDate
                from inventItemPriceCompare
                    join PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                         ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId
                        from inventItemPriceSim
                            where inventItemPriceSim.VersionId      == contract.parmCompareVersionId()
                               && inventItemPriceSim.ItemId         == inventItemPriceCompare.ItemId
                               && inventItemPriceSim.InventDimId    == inventItemPriceCompare.InventDimId
                               && inventItemPriceSim.PriceType      == inventItemPriceCompare.PriceType
                               && inventItemPriceSim.FromDate       == inventItemPriceCompare.FromDate
                    join inventItemPriceCompareTo
                        where inventItemPriceCompareTo.ItemId       == inventItemPriceCompare.ItemId
                           && inventItemPriceCompareTo.InventDimId  == inventItemPriceCompare.InventDimId
                           && inventItemPriceCompareTo.PriceType    == inventItemPriceCompare.PriceType
                            join FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod
                                from inventItemPriceSimTo
                                    where inventItemPriceSimTo.VersionId    == contract.parmCompareToVersionId()
                                       && inventItemPriceSimTo.ItemId       == inventItemPriceCompareTo.ItemId
                                       && inventItemPriceSimTo.InventDimId  == inventItemPriceCompareTo.InventDimId
                                       && inventItemPriceSimTo.PriceType    == inventItemPriceCompareTo.PriceType
                                       && inventItemPriceSimTo.FromDate     == inventItemPriceCompareTo.FromDate
                                        join CostGroupId, UnitPrice, CostGroupType, detailCostLevel
                                            from inventItemCostGroupRollupSimTo
                                                where inventItemCostGroupRollupSimTo.InventItemPriceSimRefRecId == inventItemPriceSimTo.RecId
                    join Name, DefaultOrderType
                        from inventItemPriceCompareItemView
                            where inventItemPriceCompareItemView.ItemId == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareItemView.ItemDataAreaId == inventItemPriceCompare.DataAreaId
                    notexists join inventItemCostGroupRollupSim
                        where inventItemCostGroupRollupSim.InventItemPriceSimRefRecId == inventItemPriceSim.RecId
                           && inventItemCostGroupRollupSim.CostGroupId                == inventItemCostGroupRollupSimTo.CostGroupId;
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareResultForSimRollupNXTo</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts compare result for active rollup where rollup doesn't exists for compare to.
    /// </summary>
    private void insertCompareResultForSimRollupNXTo()
    {
        InventItemPriceSimView              inventItemPriceSim, inventItemPriceSimTo;
        inventItemCostGroupRollupSimView    inventItemCostGroupRollupSim, inventItemCostGroupRollupSimTo;
        InventItemPriceCompareItemView      inventItemPriceCompareItemView;

        insert_recordset inventItemPriceCompareResult(
                ItemId, InventDimId, FromDate,
                Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                #inventDimDevelop
                ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId,
                CostGroupId, UnitPrice,
                CostGroupType, CostLevel,
                CompareToFromDate, CompareToPriceUnit, CompareToMarkup, CompareToPriceQty, CompareToPriceAllocateMarkup, CompareToUnitID, CompareToCostCalculationMethod,
                ItemName, DefaultOrderType)
            select ItemId, InventDimId, FromDate
                from inventItemPriceCompare
                    join Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                         ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId
                        from inventItemPriceSim
                            where inventItemPriceSim.VersionId      == contract.parmCompareVersionId()
                               && inventItemPriceSim.ItemId         == inventItemPriceCompare.ItemId
                               && inventItemPriceSim.InventDimId    == inventItemPriceCompare.InventDimId
                               && inventItemPriceSim.PriceType      == inventItemPriceCompare.PriceType
                               && inventItemPriceSim.FromDate       == inventItemPriceCompare.FromDate
                                join CostGroupId, UnitPrice, CostGroupType, detailCostLevel
                                    from inventItemCostGroupRollupSim
                                        where inventItemCostGroupRollupSim.InventItemPriceSimRefRecId == inventItemPriceSim.RecId
                    join inventItemPriceCompareTo
                        where inventItemPriceCompareTo.ItemId       == inventItemPriceCompare.ItemId
                           && inventItemPriceCompareTo.InventDimId  == inventItemPriceCompare.InventDimId
                           && inventItemPriceCompareTo.PriceType    == inventItemPriceCompare.PriceType
                            join FromDate, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod
                                from inventItemPriceSimTo
                                    where inventItemPriceSimTo.VersionId         == contract.parmCompareToVersionId()
                                       && inventItemPriceSimTo.ItemId            == inventItemPriceCompareTo.ItemId
                                       && inventItemPriceSimTo.InventDimId       == inventItemPriceCompareTo.InventDimId
                                       && inventItemPriceSimTo.PriceType         == inventItemPriceCompareTo.PriceType
                                       && inventItemPriceSimTo.FromDate          == inventItemPriceCompareTo.FromDate
                    join Name, DefaultOrderType
                        from inventItemPriceCompareItemView
                            where inventItemPriceCompareItemView.ItemId == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareItemView.ItemDataAreaId == inventItemPriceCompare.DataAreaId
                    notexists join inventItemCostGroupRollupSimTo
                        where inventItemCostGroupRollupSimTo.InventItemPriceSimRefRecId == inventItemPriceSimTo.RecId
                           && inventItemCostGroupRollupSimTo.CostGroupId                == inventItemCostGroupRollupSim.CostGroupId;
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareResultForSimulatedPrices</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts the compare results for simulated prices into the temporary table inventItemPriceCompareResult.
    /// </summary>
    private void insertCompareResultForSimulatedPrices()
    {
        InventItemPriceSimView          inventItemPriceSim, inventItemPriceSimCompare;
        InventItemPriceCompareItemView  inventItemPriceCompareItemView;

        if (this.compareTotal())
        {
            insert_recordset inventItemPriceCompareResult(
                    ItemId, InventDimId, FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                    #inventDimDevelop
                    ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId,
                    CompareToFromDate, CompareToPrice, CompareToPriceUnit, CompareToMarkup, CompareToPriceQty, CompareToPriceAllocateMarkup, CompareToUnitID, CompareToCostCalculationMethod,
                    ItemName, DefaultOrderType)
                select ItemId, InventDimId, FromDate
                    from inventItemPriceCompare
                        join Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod,
                             ConfigId, InventSizeId, InventColorId, InventSiteId, InventStyleId, InventVersionId
                            from inventItemPriceSim
                                where inventItemPriceSim.VersionId      == contract.parmCompareVersionId()
                                   && inventItemPriceSim.ItemId         == inventItemPriceCompare.ItemId
                                   && inventItemPriceSim.InventDimId    == inventItemPriceCompare.InventDimId
                                   && inventItemPriceSim.PriceType      == inventItemPriceCompare.PriceType
                                   && inventItemPriceSim.FromDate       == inventItemPriceCompare.FromDate
                        join inventItemPriceCompareTo
                            where inventItemPriceCompareTo.ItemId       == inventItemPriceCompare.ItemId
                               && inventItemPriceCompareTo.InventDimId  == inventItemPriceCompare.InventDimId
                               && inventItemPriceCompareTo.PriceType    == inventItemPriceCompare.PriceType
                                join FromDate, Price, PriceUnit, Markup, PriceQty, PriceAllocateMarkup, UnitID, CostCalculationMethod
                                    from inventItemPriceSimCompare
                                        where inventItemPriceSimCompare.VersionId         == contract.parmCompareToVersionId()
                                           && inventItemPriceSimCompare.ItemId            == inventItemPriceCompareTo.ItemId
                                           && inventItemPriceSimCompare.InventDimId       == inventItemPriceCompareTo.InventDimId
                                           && inventItemPriceSimCompare.PriceType         == inventItemPriceCompareTo.PriceType
                                           && inventItemPriceSimCompare.FromDate          == inventItemPriceCompareTo.FromDate
                        join Name, DefaultOrderType
                            from inventItemPriceCompareItemView
                                where inventItemPriceCompareItemView.ItemId == inventItemPriceCompare.ItemId
                                   && inventItemPriceCompareItemView.ItemDataAreaId == inventItemPriceCompare.DataAreaId;
        }
        if (this.compareRollup())
        {
            this.insertCompareResultForSimRollup();
            this.insertCompareResultForSimRollupNX();
            this.insertCompareResultForSimRollupNXTo();
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareToForActivePrices</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts active prices to compare to into the temporary table inventItemPriceCompareTo.
    /// </summary>
    private void insertCompareToForActivePrices()
    {
        InventItemPrice         inventItemPrice;
        InventItemPriceCompare  inventItemPriceCompareToTmp;

        insert_recordset inventItemPriceCompareToTmp(ItemId, InventDimId, PriceType, FromDate)
            select ItemId, InventDimId, PriceType, maxof(ActivationDate)
                from inventItemPrice
            group by ItemId, InventDimId, PriceType
            where inventItemPrice.CostingType   == CostingVersion::convertCostingType2InventItemCostingType(costingVersion.CostingType)
               && inventItemPrice.ActivationDate <= contract.parmCompareToDate()
                exists join inventItemPriceCompare
                    where inventItemPriceCompare.ItemId        == inventItemPrice.ItemId
                       && inventItemPriceCompare.InventDimId   == inventItemPrice.InventDimId
                       && inventItemPriceCompare.PriceType     == inventItemPrice.PriceType;

        insert_recordset inventItemPriceCompareTo(ItemId, InventDimId, PriceType, FromDate, ActivatedDataTime)
            select ItemId, InventDimId, PriceType, FromDate
                from inventItemPriceCompareToTmp
            group by ItemId, InventDimId, PriceType, FromDate
                join maxof(CreatedDateTime)
                    from inventItemPrice
                        where inventItemPrice.ItemId        == inventItemPriceCompareToTmp.ItemId
                           && inventItemPrice.InventDimId   == inventItemPriceCompareToTmp.InventDimId
                           && inventItemPrice.PriceType     == inventItemPriceCompareToTmp.PriceType
                           && inventItemPrice.CostingType   == CostingVersion::convertCostingType2InventItemCostingType(costingVersion.CostingType);
    }

]]></Source>
			</Method>
			<Method>
				<Name>insertCompareToForSimulatedPrices</Name>
				<Source><![CDATA[
    /// <summary>
    /// Inserts simulated prices to compare to into the temporary table inventItemPriceCompareTo.
    /// </summary>
    private void insertCompareToForSimulatedPrices()
    {
        InventItemPriceSim      inventItemPriceSim;

        insert_recordset inventItemPriceCompareTo (ItemId, InventDimId, PriceType, FromDate)
            select ItemId, InventDimId, PriceType, maxof(FromDate)
                from inventItemPriceSim
            group by ItemId, InventDimId, PriceType
            where inventItemPriceSim.VersionId == contract.parmCompareToVersionId()
               && inventItemPriceSim.FromDate <= contract.parmCompareToDate()
                join inventItemPriceCompare
                    where inventItemPriceCompare.ItemId        == inventItemPriceSim.ItemId
                        && inventItemPriceCompare.InventDimId   == inventItemPriceSim.InventDimId
                        && inventItemPriceCompare.PriceType     == inventItemPriceSim.PriceType;
    }

]]></Source>
			</Method>
			<Method>
				<Name>processReport</Name>
				<Source><![CDATA[
    /// <summary>
    /// Processes the business logic of the SQL Server Reporting Services (SSRS) report.
    /// </summary>
    /// <remarks>
    /// This method will be called by SSRS at run time.The method will compute the data and populate the
    /// data tables that will be returned to SSRS.
    /// </remarks>
    public void processReport()
    {
        super();
        detailCostLevel = InventCostLevel::Multi;

        contract = this.parmDataContract() as InventItemPriceCompareContract;
        contract.parmQuery(this.parmQuery());

        costingVersion = CostingVersion::find(contract.parmCompareVersionId());
        compareToCostingVersion = CostingVersion::find(contract.parmCompareToVersionId());

        this.insertComparePrices();
        if (contract.parmCompareTo() == CostingVersionCompareTo::Active)
        {
            this.insertCompareToForActivePrices();
            this.insertCompareResultForActivePrices();
        }
        else
        {
            this.insertCompareToForSimulatedPrices();
            this.insertCompareResultForSimulatedPrices();
        }
        this.insertCompareResultForNonExistingPrices();

        this.updateCalculatedFieldsOnResult();
        if (contract.parmCalculateInventory())
        {
            this.updateOnHand();
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateCalculatedFieldsOnResult</Name>
				<Source><![CDATA[
    /// <summary>
    /// Updates the calculated fields on the result.
    /// </summary>
    private void updateCalculatedFieldsOnResult()
    {
        if (this.compareTotal())
        {
            update_recordset inventItemPriceCompareResult
            setting UnitPrice = (inventItemPriceCompareResult.Price / inventItemPriceCompareResult.PriceUnit) +
                                (inventItemPriceCompareResult.PriceAllocateMarkup * inventItemPriceCompareResult.Markup / inventItemPriceCompareResult.PriceQty),
                    CompareToUnitPrice = (inventItemPriceCompareResult.CompareToPrice / inventItemPriceCompareResult.CompareToPriceUnit) +
                                         (inventItemPriceCompareResult.CompareToPriceAllocateMarkup * inventItemPriceCompareResult.CompareToMarkup / inventItemPriceCompareResult.CompareToPriceQty),
                    NetChange = ((inventItemPriceCompareResult.Price / inventItemPriceCompareResult.PriceUnit) +
                                 (inventItemPriceCompareResult.PriceAllocateMarkup * inventItemPriceCompareResult.Markup / inventItemPriceCompareResult.PriceQty)) -
                                ((inventItemPriceCompareResult.CompareToPrice / inventItemPriceCompareResult.CompareToPriceUnit) +
                                 (inventItemPriceCompareResult.CompareToPriceAllocateMarkup * inventItemPriceCompareResult.CompareToMarkup / inventItemPriceCompareResult.CompareToPriceQty))
            where inventItemPriceCompareResult.CostLevel == InventCostLevel::Total;
        }

        if (this.compareRollup())
        {
            update_recordset inventItemPriceCompareResult
            setting NetChange = inventItemPriceCompareResult.UnitPrice - inventItemPriceCompareResult.CompareToUnitPrice
            where inventItemPriceCompareResult.CostLevel == InventCostLevel::Multi;
        }
    }

]]></Source>
			</Method>
			<Method>
				<Name>updateOnHand</Name>
				<Source><![CDATA[
    /// <summary>
    /// Updates the the on-hand quantity on the result.
    /// </summary>
    private void updateOnHand()
    {
        InventSum                       inventSum;
        InventDim                       inventDimCompare, inventDimSum;
        InventDimParm                   inventDimParm, inventDimParmAllowBlank;
        InventItemPriceCompareOnHand    inventItemPriceCompareOnHand;

        inventDimParm.initFromInventDimFieldList(InventDim::dimProductDimFieldList());
        inventDimParmAllowBlank.initFromInventDimParm(inventDimParm);
        inventDimParm.InventSiteIdFlag = NoYes::Yes;

        if (isInventItemPriceComparePerformanceFlightEnabled)
        {
            insert_recordset inventItemPriceCompareOnHand(ItemId, InventDimId, PostedQty, Received, Deducted)
                select ItemId, InventDimId
                    from inventItemPriceCompare
                    group by ItemId, InventDimId
                    join sum(PostedQty), sum(Received), sum(Deducted)
                        from inventSum
                            where inventSum.ItemId == inventItemPriceCompare.ItemId &&
                                (inventItemPriceCompare.ConfigId == inventSum.ConfigId || !inventDimParm.ConfigIdFlag || (inventDimParmAllowBlank.ConfigIdFlag && inventItemPriceCompare.ConfigId == '')) &&
                                (inventItemPriceCompare.InventSizeId == inventSum.InventSizeId || !inventDimParm.InventSizeIdFlag || (inventDimParmAllowBlank.InventSizeIdFlag && inventItemPriceCompare.InventSizeId == '')) &&
                                (inventItemPriceCompare.InventColorId == inventSum.InventColorId || !inventDimParm.InventColorIdFlag || (inventDimParmAllowBlank.InventColorIdFlag && inventItemPriceCompare.InventColorId == '')) &&
                                (inventItemPriceCompare.InventVersionId == inventSum.InventVersionId || !inventDimParm.InventVersionIdFlag || (inventDimParmAllowBlank.InventVersionIdFlag && inventItemPriceCompare.InventVersionId == '')) &&
                                (inventItemPriceCompare.InventStyleId == inventSum.InventStyleId || !inventDimParm.InventStyleIdFlag || (inventDimParmAllowBlank.InventStyleIdFlag && inventItemPriceCompare.InventStyleId == '')) &&
                                (inventItemPriceCompare.InventSiteId == inventSum.InventSiteId || !inventDimParm.InventSiteIdFlag || (inventDimParmAllowBlank.InventSiteIdFlag && inventItemPriceCompare.InventSiteId == ''));
        }
        else
        {
            insert_recordset inventItemPriceCompareOnHand(ItemId, InventDimId, PostedQty, Received, Deducted)
                select ItemId, InventDimId
                    from inventItemPriceCompare
                group by ItemId, InventDimId
                    join sum(PostedQty), sum(Received), sum(Deducted)
                        from inventSum
                            where inventSum.ItemId == inventItemPriceCompare.ItemId
                                join inventDimSum
                                    where inventDimSum.InventDimId == inventSum.InventDimId
                                        exists join inventDimCompare
                                            where (inventDimCompare.InventDimId == inventItemPriceCompare.InventDimId) &&
                                                #InventDimRanges(inventDimCompare, inventDimSum, inventDimParm, inventDimParmAllowBlank);
        }

        update_recordset inventItemPriceCompareResult
            setting InventQty = inventItemPriceCompareOnHand.PostedQty + inventItemPriceCompareOnHand.Received - inventItemPriceCompareOnHand.Deducted,
                    NetChangeOnhandValue = (inventItemPriceCompareOnHand.PostedQty + inventItemPriceCompareOnHand.Received - inventItemPriceCompareOnHand.Deducted) * inventItemPriceCompareResult.NetChange,
                    CompareToOnhandValue = (inventItemPriceCompareOnHand.PostedQty + inventItemPriceCompareOnHand.Received - inventItemPriceCompareOnHand.Deducted) * inventItemPriceCompareResult.CompareToUnitPrice,
                    OnhandValue = (inventItemPriceCompareOnHand.PostedQty + inventItemPriceCompareOnHand.Received - inventItemPriceCompareOnHand.Deducted) * inventItemPriceCompareResult.UnitPrice
            join inventItemPriceCompareOnHand
                where inventItemPriceCompareOnHand.ItemId == inventItemPriceCompareResult.ItemId
                   && inventItemPriceCompareOnHand.InventDimId == inventItemPriceCompareResult.InventDimId;
    }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>